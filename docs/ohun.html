<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>OTS Bioacoustic Analysis in R 2023 - ohun: optimizing acoustic signal detection</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">OTS Bioacoustic Analysis in R 2023</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./program.html">
 <span class="menu-text">Program</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tutorials" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Tutorials</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tutorials">    
        <li>
    <a class="dropdown-item" href="./introduction.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./r_basics.html">
 <span class="dropdown-text">R basics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./sound.html">
 <span class="dropdown-text">Sound</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./spectrograms.html">
 <span class="dropdown-text">Spectrograms</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./seewave.html">
 <span class="dropdown-text">seewave</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./annotations.html">
 <span class="dropdown-text">Annotations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./ohun.html">
 <span class="dropdown-text">ohun: automatic detection</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./intro_to_warbler.html">
 <span class="dropdown-text">Intro to warbleR</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./measure_acoustic_structure.html">
 <span class="dropdown-text">Measure acoustic structure</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./comparing_methods.html">
 <span class="dropdown-text">Comparing measuring methods</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./quality_checks.html">
 <span class="dropdown-text">Quality checks</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./measure_structure_green_hermit.html">
 <span class="dropdown-text">Measure structure on XC recordings</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-colab-notebooks" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Colab notebooks</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-colab-notebooks">    
        <li>
    <a class="dropdown-item" href="./general_redirect.html">
 <span class="dropdown-text">General</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./dynaspec_redirect.html">
 <span class="dropdown-text">dynaSpec</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./ohun_redirect.html">
 <span class="dropdown-text">ohun</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./course_prep.html">
 <span class="menu-text">Course prep</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./code_redirect.html">
 <span class="menu-text">Code sharing</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./instructor.html">
 <span class="menu-text">Instructor</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/maRce10/OTS_BIR_2023/"><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="collapse">
  <li><a href="#automatic-sound-event-detection" id="toc-automatic-sound-event-detection" class="nav-link active" data-scroll-target="#automatic-sound-event-detection"><span class="toc-section-number">1</span>  Automatic sound event detection</a></li>
  <li><a href="#signal-detection-theory-applied-to-bioacoustics" id="toc-signal-detection-theory-applied-to-bioacoustics" class="nav-link" data-scroll-target="#signal-detection-theory-applied-to-bioacoustics"><span class="toc-section-number">2</span>  Signal detection theory applied to bioacoustics</a></li>
  <li><a href="#detecting-sound-events-with-ohun" id="toc-detecting-sound-events-with-ohun" class="nav-link" data-scroll-target="#detecting-sound-events-with-ohun"><span class="toc-section-number">3</span>  Detecting sound events with <em>ohun</em></a>
  <ul class="collapse">
  <li><a href="#energy-based-detection" id="toc-energy-based-detection" class="nav-link" data-scroll-target="#energy-based-detection"><span class="toc-section-number">3.1</span>  Energy-based detection</a></li>
  <li><a href="#template-based-detection" id="toc-template-based-detection" class="nav-link" data-scroll-target="#template-based-detection"><span class="toc-section-number">3.2</span>  Template-based detection</a></li>
  <li><a href="#improving-detection-speed" id="toc-improving-detection-speed" class="nav-link" data-scroll-target="#improving-detection-speed"><span class="toc-section-number">3.3</span>  Improving detection speed</a></li>
  <li><a href="#additional-tips" id="toc-additional-tips" class="nav-link" data-scroll-target="#additional-tips"><span class="toc-section-number">3.4</span>  Additional tips</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="toc-section-number">3.5</span>  References</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><font size="7"><b><i>ohun</i>: optimizing acoustic signal detection</b></font></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="objetive" class="level2 unnumbered unlisted alert alert-info">
<h2 class="unnumbered unlisted anchored" data-anchor-id="objetive"><strong>Objetive</strong></h2>
<ul>
<li><p>Get familiar with concepts and data formatting practices related to automatic acoustic signals detection</p></li>
<li><p>Learn how to run automatic detection using the package ohun</p></li>
</ul>
</section>
<p>&nbsp;</p>
<p><a href="https://github.com/maRce10/ohun">ohun</a> is intended to facilitate the automated detection of sound events, providing functions to diagnose and optimize detection routines. Detections from other software can also be explored and optimized.</p>
<p>&nbsp;</p>
<div class="alert alert-info">
<p><font size="4">The main features of the package are: </font></p>
<ul>
<li>The use of reference annotations for detection optimization and diagnostic</li>
<li>The use of signal detection theory indices to evaluate detection performance</li>
</ul>
<p>&nbsp;</p>
<p><font size="4">The package offers functions for: </font></p>
<ul>
<li>Curate references and acoustic data sets</li>
<li>Diagnose detection performance</li>
<li>Optimize detection routines based on reference annotations</li>
<li>Energy-based detection</li>
<li>Template-based detection</li>
</ul>
</div>
<p>&nbsp;</p>
<p>All functions allow the parallelization of tasks, which distributes the tasks among several processors to improve computational efficiency. The package works on sound files in ‘.wav’, ‘.mp3’, ‘.flac’ and ‘.wac’ format.</p>
<hr>
<p>To install the latest developmental version from <a href="https://github.com/">github</a> you will need the R package <a href="https://cran.r-project.org/package=devtools">remotes</a>:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install pacakge</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"maRce10/ohun"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#load package</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ohun)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">

</div>
<p>&nbsp;</p>
<hr>
<section id="automatic-sound-event-detection" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Automatic sound event detection</h1>
<p>Finding the position of sound events in a sound file is a challenging task. <a href="https://github.com/maRce10/ohun">ohun</a> offers two methods for automated sound event detection: template-based and energy-based detection. These methods are better suited for highly stereotyped or good signal-to-noise ratio (SNR) sounds, respectively. If the target sound events don’t fit these requirements, more elaborated methods (i.e.&nbsp;machine learning approaches) are warranted:</p>
<figure class="figure">
<center>
<img src="images/analysis_workflow.png" alt="automated signal detection diagram" width="500" height="450" class="figure-img">
</center>
<figcaption class="figure-caption">
<i>Diagram depicting how target sound event features can be used to tell the most adequate sound event detection approach. Steps in which ‘ohun’ can be helpful are shown in color. (SNR = signal-to-noise ratio) </i>
</figcaption>
</figure>
<p>&nbsp;</p>
<p>Still, a detection run using other software can be optimized with the tools provided in <a href="https://github.com/maRce10/ohun">ohun</a>.</p>
<p>&nbsp;</p>
</section>
<section id="signal-detection-theory-applied-to-bioacoustics" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Signal detection theory applied to bioacoustics</h1>
<p>Broadly speaking, signal detection theory deals with the process of recovering signals (i.e.&nbsp;target signals) from background noise (not necessarily acoustic noise) and it’s widely used for optimizing this decision making process in the presence of uncertainty. During a detection routine, the detected ‘items’ can be classified into 4 classes:</p>
<ul>
<li><strong>True positives (TPs)</strong>: signals correctly identified as ‘signal’</li>
<li><strong>False positives (FPs)</strong>: background noise incorrectly identified as ‘signal’</li>
<li><strong>False negatives (FNs)</strong>: signals incorrectly identified as ‘background noise’</li>
<li><strong>True negatives (TNs)</strong>: background noise correctly identified as ‘background noise’</li>
</ul>
<p>Several additional indices derived from these indices are used to evaluate the performance of a detection routine. These are three useful indices in the context of sound event detection included in <a href="https://github.com/maRce10/ohun">ohun</a>:</p>
<ul>
<li><strong>Recall</strong>: correct detections relative to total references (a.k.a. true positive rate or sensitivity; <em>TPs / (TPs + FNs)</em>)</li>
<li><strong>Precision</strong>: correct detections relative to total detections (<em>TPs / (TPs + FPs)</em>).</li>
<li><strong>F1 score</strong>: combines recall and precision as the harmonic mean of these two, so it provides a single value for evaluating performance (a.k.a. F-measure or Dice similarity coefficient).</li>
</ul>
<p><font size="2"><em>(Metrics that make use of ‘true negatives’ cannot be easily applied in the context of sound event detection as noise cannot always be partitioned in discrete units)</em></font></p>
<p>A perfect detection will have no false positives or false negatives, which will result in both recall and precision equal to 1. However, perfect detection cannot always be reached and some compromise between detecting all target signals plus some noise (recall = 1 &amp; precision &lt; 1) and detecting only target signals but not all of them (recall &lt; 1 &amp; precision = 1) is warranted. The right balance between these two extremes will be given by the relative costs of missing signals and mistaking noise for signals. Hence, these indices provide an useful framework for diagnosing and optimizing the performance of a detection routine.</p>
<p>The package <a href="https://github.com/maRce10/ohun">ohun</a> provides a set of tools to evaluate the performance of an sound event detection based on the indices described above. To accomplish this, the result of a detection routine is compared against a reference table containing the time position of all target sound events in the sound files. The package comes with an example reference table containing annotations of long-billed hermit hummingbird songs from two sound files (also supplied as example data: ‘lbh1’ and ‘lbh2’), which can be used to illustrate detection performance evaluation. The example data can be explored as follows:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load example data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"lbh1"</span>, <span class="st">"lbh2"</span>, <span class="st">"lbh_reference"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>lbh_reference</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">sound.files</th>
<th style="text-align: right;">selec</th>
<th style="text-align: right;">start</th>
<th style="text-align: right;">end</th>
<th style="text-align: right;">bottom.freq</th>
<th style="text-align: right;">top.freq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">lbh2.wav</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.109161</td>
<td style="text-align: right;">0.2482449</td>
<td style="text-align: right;">2.2954</td>
<td style="text-align: right;">8.9382</td>
</tr>
<tr class="even">
<td style="text-align: left;">lbh2.wav</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.654921</td>
<td style="text-align: right;">0.7887232</td>
<td style="text-align: right;">2.2954</td>
<td style="text-align: right;">9.0426</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lbh2.wav</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1.265850</td>
<td style="text-align: right;">1.3855678</td>
<td style="text-align: right;">2.2606</td>
<td style="text-align: right;">9.0774</td>
</tr>
<tr class="even">
<td style="text-align: left;">lbh2.wav</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1.869705</td>
<td style="text-align: right;">2.0052678</td>
<td style="text-align: right;">2.1911</td>
<td style="text-align: right;">8.9035</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lbh2.wav</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2.441769</td>
<td style="text-align: right;">2.5808529</td>
<td style="text-align: right;">2.1563</td>
<td style="text-align: right;">8.6600</td>
</tr>
<tr class="even">
<td style="text-align: left;">lbh2.wav</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">3.036825</td>
<td style="text-align: right;">3.1688667</td>
<td style="text-align: right;">2.2259</td>
<td style="text-align: right;">8.9382</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lbh2.wav</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">3.628617</td>
<td style="text-align: right;">3.7465742</td>
<td style="text-align: right;">2.3302</td>
<td style="text-align: right;">8.6252</td>
</tr>
<tr class="even">
<td style="text-align: left;">lbh2.wav</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">4.153288</td>
<td style="text-align: right;">4.2818085</td>
<td style="text-align: right;">2.2954</td>
<td style="text-align: right;">8.4861</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lbh2.wav</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">4.723673</td>
<td style="text-align: right;">4.8609963</td>
<td style="text-align: right;">2.3650</td>
<td style="text-align: right;">8.6948</td>
</tr>
<tr class="even">
<td style="text-align: left;">lbh1.wav</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0.088118</td>
<td style="text-align: right;">0.2360047</td>
<td style="text-align: right;">1.9824</td>
<td style="text-align: right;">8.4861</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lbh1.wav</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">0.572290</td>
<td style="text-align: right;">0.7201767</td>
<td style="text-align: right;">2.0520</td>
<td style="text-align: right;">9.5295</td>
</tr>
<tr class="even">
<td style="text-align: left;">lbh1.wav</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1.056417</td>
<td style="text-align: right;">1.1972614</td>
<td style="text-align: right;">2.0868</td>
<td style="text-align: right;">8.4861</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lbh1.wav</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1.711338</td>
<td style="text-align: right;">1.8680274</td>
<td style="text-align: right;">1.9824</td>
<td style="text-align: right;">8.5905</td>
</tr>
<tr class="even">
<td style="text-align: left;">lbh1.wav</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">2.190249</td>
<td style="text-align: right;">2.3416568</td>
<td style="text-align: right;">2.0520</td>
<td style="text-align: right;">8.5209</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lbh1.wav</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">2.697143</td>
<td style="text-align: right;">2.8538324</td>
<td style="text-align: right;">1.9824</td>
<td style="text-align: right;">9.2513</td>
</tr>
<tr class="even">
<td style="text-align: left;">lbh1.wav</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">3.181315</td>
<td style="text-align: right;">3.3344833</td>
<td style="text-align: right;">1.9129</td>
<td style="text-align: right;">8.4861</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lbh1.wav</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">3.663719</td>
<td style="text-align: right;">3.8133662</td>
<td style="text-align: right;">1.8781</td>
<td style="text-align: right;">8.6948</td>
</tr>
<tr class="even">
<td style="text-align: left;">lbh1.wav</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">4.140816</td>
<td style="text-align: right;">4.3045477</td>
<td style="text-align: right;">1.8433</td>
<td style="text-align: right;">9.2165</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lbh1.wav</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">4.626712</td>
<td style="text-align: right;">4.7851620</td>
<td style="text-align: right;">1.8085</td>
<td style="text-align: right;">8.9035</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>All <a href="https://github.com/maRce10/ohun">ohun</a> functions that work with this kind of data can take both selection tables and data frames. Spectrograms with highlighted sound events from a selection table can be plotted with the function <code>label_spectro()</code> (this function only plots one wave object at the time):</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save sound file</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">writeWave</span>(lbh1, <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">"lbh1.wav"</span>))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># save sound file</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">writeWave</span>(lbh2, <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">"lbh2.wav"</span>))</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># print spectrogram</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">wave =</span> lbh1,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">reference =</span> lbh_reference[lbh_reference<span class="sc">$</span>sound.files <span class="sc">==</span> <span class="st">"lbh1.wav"</span>,],</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">hop.size =</span> <span class="dv">10</span>,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">ovlp =</span> <span class="dv">50</span>,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">flim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ohun_files/figure-html/unnamed-chunk-3-1.jpeg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print spectrogram</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">wave =</span> lbh2,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">reference =</span> lbh_reference[lbh_reference<span class="sc">$</span>sound.files <span class="sc">==</span> <span class="st">"lbh2.wav"</span>,],</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">hop.size =</span> <span class="dv">10</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">ovlp =</span> <span class="dv">50</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">flim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ohun_files/figure-html/unnamed-chunk-3-2.jpeg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>The function <code>diagnose_detection()</code> evaluates the performance of a detection routine by comparing it to a reference table. For instance, a perfect detection is given by comparing <code>lbh_reference</code> to itself:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>lbh1_reference <span class="ot">&lt;-</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  lbh_reference[lbh_reference<span class="sc">$</span>sound.files <span class="sc">==</span> <span class="st">"lbh1.wav"</span>,]</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># diagnose</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">diagnose_detection</span>(<span class="at">reference =</span> lbh1_reference, </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">detection =</span> lbh1_reference)[, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 18%">
<col style="width: 16%">
<col style="width: 17%">
<col style="width: 28%">
<col style="width: 7%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">total.detections</th>
<th style="text-align: right;">true.positives</th>
<th style="text-align: right;">false.positives</th>
<th style="text-align: right;">overlap.to.true.positives</th>
<th style="text-align: right;">recall</th>
<th style="text-align: right;">precision</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>We will work mostly with a single sound file for convenience but the functions can work on several sound files at the time. The files should be found in a single working directory. Although the above example is a bit silly, it shows the basic diagnostic indices, which include basic detection theory indices (‘true.positives’, ‘false.positives’, ‘false.negatives’, ‘recall’ and ‘precision’) mentioned above. We can play around with the reference table to see how these indices can be used to spot imperfect detection routines (and hopefully improve them!). For instance, we can remove some sound events to see how this is reflected in the diagnostics. Getting rid of some rows in ‘detection’, simulating a detection with some false negatives, will affect the recall but not the precision:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create new table</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>lbh1_detection <span class="ot">&lt;-</span> lbh1_reference[<span class="dv">3</span><span class="sc">:</span><span class="dv">9</span>, ]</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># print spectrogram</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">wave =</span> lbh1,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">reference =</span> lbh1_reference,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">detection =</span> lbh1_detection,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">hop.size =</span> <span class="dv">10</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">ovlp =</span> <span class="dv">50</span>,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">flim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ohun_files/figure-html/unnamed-chunk-5-1.jpeg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># diagnose</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">diagnose_detection</span>(<span class="at">reference =</span> lbh1_reference, </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">detection =</span> lbh1_detection)[, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 18%">
<col style="width: 16%">
<col style="width: 17%">
<col style="width: 28%">
<col style="width: 7%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">total.detections</th>
<th style="text-align: right;">true.positives</th>
<th style="text-align: right;">false.positives</th>
<th style="text-align: right;">overlap.to.true.positives</th>
<th style="text-align: right;">recall</th>
<th style="text-align: right;">precision</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.7</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>Having some additional sound events not in reference will do the opposite, reducing precision but not recall. We can do this simply by switching the tables:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print spectrogram</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">wave =</span> lbh1,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">detection =</span> lbh1_reference,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">reference =</span> lbh1_detection,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">hop.size =</span> <span class="dv">10</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">ovlp =</span> <span class="dv">50</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">flim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ohun_files/figure-html/unnamed-chunk-6-1.jpeg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># diagnose</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">diagnose_detection</span>(<span class="at">reference =</span> lbh1_detection, </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">detection =</span> lbh1_reference)[, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 18%">
<col style="width: 16%">
<col style="width: 17%">
<col style="width: 28%">
<col style="width: 7%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">total.detections</th>
<th style="text-align: right;">true.positives</th>
<th style="text-align: right;">false.positives</th>
<th style="text-align: right;">overlap.to.true.positives</th>
<th style="text-align: right;">recall</th>
<th style="text-align: right;">precision</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.7</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>The function offers three additional diagnose metrics:</p>
<ul>
<li><strong>Split positives</strong>: target sound events overlapped by more than 1 detecion</li>
<li><strong>Merged positives</strong>: number of cases in which 2 or more target sound events in ‘reference’ were overlapped by the same detection</li>
<li><strong>Proportional overlap of true positives</strong>: ratio of the time overlap of true positives with its corresponding sound event in the reference table</li>
</ul>
<p>In a perfect detection routine split and merged positives should be 0 while proportional overlap should be 1. We can shift the start of sound events a bit to reflect a detection in which there is some mismatch to the reference table regarding to the time location of sound events:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create new table</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>lbh1_detection <span class="ot">&lt;-</span> lbh1_reference</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># add 'noise' to start</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">18</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>lbh1_detection<span class="sc">$</span>start <span class="ot">&lt;-</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  lbh1_detection<span class="sc">$</span>start <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(lbh1_detection), </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>                               <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.1</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="do">## print spectrogram</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">wave =</span> lbh1,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">reference =</span> lbh1_reference,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">detection =</span> lbh1_detection,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">hop.size =</span> <span class="dv">10</span>,</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">ovlp =</span> <span class="dv">50</span>,</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">flim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ohun_files/figure-html/unnamed-chunk-7-1.jpeg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># diagnose</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">diagnose_detection</span>(<span class="at">reference =</span> lbh1_reference, </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">detection =</span> lbh1_detection)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 11%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 11%">
<col style="width: 17%">
<col style="width: 4%">
<col style="width: 6%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">total.detections</th>
<th style="text-align: right;">true.positives</th>
<th style="text-align: right;">false.positives</th>
<th style="text-align: right;">false.negatives</th>
<th style="text-align: right;">split.positives</th>
<th style="text-align: right;">merged.positives</th>
<th style="text-align: right;">overlap.to.true.positives</th>
<th style="text-align: right;">recall</th>
<th style="text-align: right;">precision</th>
<th style="text-align: right;">f1.score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.528</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>In addition, the following diagnostics related to the duration of the sound events can also be returned by setting <code>time.diagnostics = TRUE</code>. Here we tweak the reference and detection data just to have some false positives and false negatives:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># diagnose with time diagnostics</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">diagnose_detection</span>(<span class="at">reference =</span> lbh1_reference[<span class="sc">-</span><span class="dv">1</span>, ], <span class="at">detection =</span> lbh1_detection[<span class="sc">-</span><span class="dv">10</span>, ], <span class="at">time.diagnostics =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 13%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">total.detections</th>
<th style="text-align: right;">true.positives</th>
<th style="text-align: right;">false.positives</th>
<th style="text-align: right;">false.negatives</th>
<th style="text-align: right;">split.positives</th>
<th style="text-align: right;">merged.positives</th>
<th style="text-align: right;">overlap.to.true.positives</th>
<th style="text-align: right;">mean.duration.true.positives</th>
<th style="text-align: right;">mean.duration.false.positives</th>
<th style="text-align: right;">mean.duration.false.negatives</th>
<th style="text-align: right;">proportional.duration.true.positives</th>
<th style="text-align: right;">recall</th>
<th style="text-align: right;">precision</th>
<th style="text-align: right;">f1.score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">8</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.61125</td>
<td style="text-align: right;">139</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">158</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.8888889</td>
<td style="text-align: right;">0.8888889</td>
<td style="text-align: right;">0.8888889</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>These additional metrics can be used to further filter out undesired sound events based on their duration (for instance in a energy-based detection as in <code>energy_detector()</code>, explained below).</p>
<p>Diagnostics can also be detailed by sound file:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># diagnose by sound file</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>diagnostic <span class="ot">&lt;-</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">diagnose_detection</span>(<span class="at">reference =</span> lbh1_reference,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">detection =</span> lbh1_detection,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">by.sound.file =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>diagnostic</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 7%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 16%">
<col style="width: 4%">
<col style="width: 6%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">sound.files</th>
<th style="text-align: right;">total.detections</th>
<th style="text-align: right;">true.positives</th>
<th style="text-align: right;">false.positives</th>
<th style="text-align: right;">false.negatives</th>
<th style="text-align: right;">split.positives</th>
<th style="text-align: right;">merged.positives</th>
<th style="text-align: right;">overlap.to.true.positives</th>
<th style="text-align: right;">recall</th>
<th style="text-align: right;">precision</th>
<th style="text-align: right;">f1.score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">lbh1.wav</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.528</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>These diagnostics can be summarized (as in the default <code>diagnose_detection()</code> output) with the function <code>summarize_diagnostic()</code>:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summarize</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize_diagnostic</span>(diagnostic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 11%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 11%">
<col style="width: 17%">
<col style="width: 4%">
<col style="width: 6%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">total.detections</th>
<th style="text-align: right;">true.positives</th>
<th style="text-align: right;">false.positives</th>
<th style="text-align: right;">false.negatives</th>
<th style="text-align: right;">split.positives</th>
<th style="text-align: right;">merged.positives</th>
<th style="text-align: right;">overlap.to.true.positives</th>
<th style="text-align: right;">recall</th>
<th style="text-align: right;">precision</th>
<th style="text-align: right;">f1.score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.528</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>&nbsp;</p>
</section>
<section id="detecting-sound-events-with-ohun" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Detecting sound events with <em>ohun</em></h1>
<section id="energy-based-detection" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="energy-based-detection"><span class="header-section-number">3.1</span> Energy-based detection</h2>
<p>This detector uses amplitude envelopes to infer the position of sound events. Amplitude envelopes are representations of the variation in energy through time. The following code plots an amplitude envelope along with the spectrogram for the example data <code>lbh1</code>:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot spectrogram and envelope</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">wave =</span> <span class="fu">cutw</span>(</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    lbh1,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">from =</span> <span class="dv">0</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">to =</span> <span class="fl">1.5</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">output =</span> <span class="st">"Wave"</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">ovlp =</span> <span class="dv">90</span>,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">hop.size =</span> <span class="dv">10</span>,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">flim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">envelope =</span> <span class="cn">TRUE</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ohun_files/figure-html/unnamed-chunk-11-1.jpeg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>This type of detector doesn’t require highly stereotyped sound events, although they work better on high quality recordings in which the amplitude of target sound events is higher than the background noise (i.e.&nbsp;high signal-to-noise ratio). The function <code>energy_detector()</code> performs this type of detection.</p>
<p>&nbsp;</p>
<section id="how-it-works" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="how-it-works"><span class="header-section-number">3.1.1</span> How it works</h3>
<p>We can understand how to use <code>energy_detector()</code> using simulated sound events. We will do that using the function <code>simulate_songs()</code> from <a href="https://CRAN.R-project.org/package=warbleR">warbleR</a>. In this example we simulate a recording with 10 sounds with two different frequency ranges and durations:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install this package first if not installed</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("Sim.DiffProc")</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating vector for duration </span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>durs <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="fl">0.3</span>, <span class="dv">1</span>), <span class="dv">5</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating simulated song</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>simulated_1 <span class="ot">&lt;-</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  warbleR<span class="sc">::</span><span class="fu">simulate_songs</span>(</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="dv">10</span>,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">durs =</span> durs,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">freqs =</span> <span class="dv">5</span>,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">sig2 =</span> <span class="fl">0.01</span>,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">gaps =</span> <span class="fl">0.5</span>,</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">harms =</span> <span class="dv">1</span>,</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">bgn =</span> <span class="fl">0.1</span>,</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="fu">tempdir</span>(),</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">file.name =</span> <span class="st">"simulated_1"</span>,</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">selec.table =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="st">"cos"</span>,</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">fin =</span> <span class="fl">0.3</span>,</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">fout =</span> <span class="fl">0.35</span>,</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">samp.rate =</span> <span class="dv">18</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">$</span>wave</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
<p>The function call saves a ‘.wav’ sound file in a temporary directory (<code>tempdir()</code>) and also returns a <code>wave</code> object in the R environment. This outputs will be used to run energy-based detection and creating plots, respectively. This is how the spectrogram and amplitude envelope of the simulated recording look like:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot spectrogram and envelope</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(<span class="at">wave =</span> simulated_1,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">env =</span> <span class="cn">TRUE</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">fastdisp =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ohun_files/figure-html/unnamed-chunk-13-1.jpeg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>Note that the amplitude envelope shows a high signal-to-noise ratio of the sound events, which is ideal for energy-based detection. This can be conducted using <code>energy_detector()</code> as follows:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># run detection</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>detection <span class="ot">&lt;-</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">energy_detector</span>(</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">files =</span> <span class="st">"simulated_1.wav"</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">bp =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">8</span>),</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> <span class="dv">50</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">smooth =</span> <span class="dv">150</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> <span class="fu">tempdir</span>()</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co"># plot spectrogram and envelope</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="at">wave =</span> simulated_1,</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="at">envelope =</span> <span class="cn">TRUE</span>,</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="at">detection =</span> detection,</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="at">threshold =</span> <span class="dv">50</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ohun_files/figure-html/unnamed-chunk-14-1.jpeg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>The output is a selection table:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>detection</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">sound.files</th>
<th style="text-align: right;">duration</th>
<th style="text-align: right;">selec</th>
<th style="text-align: right;">start</th>
<th style="text-align: right;">end</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">simulated_1.wav</td>
<td style="text-align: right;">0.2328344</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.5309469</td>
<td style="text-align: right;">0.7637813</td>
</tr>
<tr class="even">
<td style="text-align: left;">simulated_1.wav</td>
<td style="text-align: right;">0.7946703</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1.3954509</td>
<td style="text-align: right;">2.1901213</td>
</tr>
<tr class="odd">
<td style="text-align: left;">simulated_1.wav</td>
<td style="text-align: right;">0.2334455</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2.8307909</td>
<td style="text-align: right;">3.0642364</td>
</tr>
<tr class="even">
<td style="text-align: left;">simulated_1.wav</td>
<td style="text-align: right;">0.7943926</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3.6955171</td>
<td style="text-align: right;">4.4899097</td>
</tr>
<tr class="odd">
<td style="text-align: left;">simulated_1.wav</td>
<td style="text-align: right;">0.2333344</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5.1307460</td>
<td style="text-align: right;">5.3640804</td>
</tr>
<tr class="even">
<td style="text-align: left;">simulated_1.wav</td>
<td style="text-align: right;">0.7945037</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">5.9955833</td>
<td style="text-align: right;">6.7900870</td>
</tr>
<tr class="odd">
<td style="text-align: left;">simulated_1.wav</td>
<td style="text-align: right;">0.2330566</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">7.4307566</td>
<td style="text-align: right;">7.6638133</td>
</tr>
<tr class="even">
<td style="text-align: left;">simulated_1.wav</td>
<td style="text-align: right;">0.7948926</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">8.2954273</td>
<td style="text-align: right;">9.0903199</td>
</tr>
<tr class="odd">
<td style="text-align: left;">simulated_1.wav</td>
<td style="text-align: right;">0.2334455</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">9.7307673</td>
<td style="text-align: right;">9.9642128</td>
</tr>
<tr class="even">
<td style="text-align: left;">simulated_1.wav</td>
<td style="text-align: right;">0.7946148</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10.5954935</td>
<td style="text-align: right;">11.3901083</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Now we will make use of some additional arguments to filter out specific sound events based on their structural features. For instance we can use the argument <code>min.duration</code> to provide a time treshold (in ms) to exclude short sound events and keep only the longest sound events:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># run detection</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>detection <span class="ot">&lt;-</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">energy_detector</span>(</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">files =</span> <span class="st">"simulated_1.wav"</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">bp =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">8</span>),</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">threshold =</span> <span class="dv">50</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">min.duration =</span> <span class="dv">500</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">smooth =</span> <span class="dv">150</span>,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="fu">tempdir</span>()</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co"># plot spectrogram</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(<span class="at">wave =</span> simulated_1, <span class="at">detection =</span> detection)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ohun_files/figure-html/unnamed-chunk-16-1.jpeg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>We can use the argument <code>max.duration</code> (also in ms) to exclude long sound events and keep the short ones:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># run detection</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>detection <span class="ot">&lt;-</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">energy_detector</span>(</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">files =</span> <span class="st">"simulated_1.wav"</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">bp =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">8</span>),</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">threshold =</span> <span class="dv">50</span>,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">smooth =</span> <span class="dv">150</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">max.duration =</span> <span class="dv">500</span>,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="fu">tempdir</span>()</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co"># plot spectrogram</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(<span class="at">wave =</span> simulated_1,  <span class="at">detection =</span> detection)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ohun_files/figure-html/unnamed-chunk-17-1.jpeg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>We can also focus the detection on specific frequency ranges using the argument <code>bp</code> (bandpass). By setting <code>bp = c(5, 8)</code> only those sound events found within that frequency range (5-8 kHz) will be detected, which excludes sound events below 5 kHz:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Detecting</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>detection <span class="ot">&lt;-</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">energy_detector</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">files =</span> <span class="st">"simulated_1.wav"</span>,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">bp =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">8</span>),</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">threshold =</span> <span class="dv">50</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">smooth =</span> <span class="dv">150</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="fu">tempdir</span>()</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co"># plot spectrogram</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(<span class="at">wave =</span> simulated_1,  <span class="at">detection =</span> detection)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ohun_files/figure-html/unnamed-chunk-18-1.jpeg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
<div class="alert alert-info">
<p><font size="5">Exercise</font></p>
<ul>
<li>Detect only the short sound below 5 kHz</li>
</ul>
<div class="cell" data-layout-align="center">

</div>
</div>
<p>&nbsp;</p>
<p>Amplitude modulation (variation in amplitude across a sound event) can be problematic for detection based on amplitude envelopes. We can also simulate some amplitude modulation using <code>warbleR::simulate_songs()</code>:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating simulated song</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating vector for duration</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>durs <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="fl">0.3</span>, <span class="dv">1</span>), <span class="dv">5</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>sim_2 <span class="ot">&lt;-</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sim_songs</span>(</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="dv">10</span>,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">durs =</span> durs,</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">freqs =</span> <span class="dv">5</span>,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">sig2 =</span> <span class="fl">0.01</span>,</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">gaps =</span> <span class="fl">0.5</span>,</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">harms =</span> <span class="dv">1</span>,</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">bgn =</span> <span class="fl">0.1</span>,</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="fu">tempdir</span>(),</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">file.name =</span> <span class="st">"simulated_2"</span>,</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">selec.table =</span> <span class="cn">TRUE</span>,</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="st">"cos"</span>,</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">fin =</span> <span class="fl">0.3</span>,</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">fout =</span> <span class="fl">0.35</span>,</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">samp.rate =</span> <span class="dv">18</span>,</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">am.amps =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="fl">0.1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a><span class="co"># extract wave object and selection table</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>simulated_2 <span class="ot">&lt;-</span> sim_2<span class="sc">$</span>wave</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>sim2_sel_table <span class="ot">&lt;-</span> sim_2<span class="sc">$</span>selec.table</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a><span class="co"># plot spectrogram</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(<span class="at">wave =</span> simulated_2, <span class="at">envelope =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ohun_files/figure-html/unnamed-chunk-20-1.jpeg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>When sound events have strong amplitude modulation they can be split during detection:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># detect sounds</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>detection <span class="ot">&lt;-</span> <span class="fu">energy_detector</span>(<span class="at">files =</span> <span class="st">"simulated_2.wav"</span>, <span class="at">threshold =</span> <span class="dv">50</span>, <span class="at">path =</span> <span class="fu">tempdir</span>())</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot spectrogram</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(<span class="at">wave =</span> simulated_2, <span class="at">envelope =</span> <span class="cn">TRUE</span>, <span class="at">threshold =</span> <span class="dv">50</span>, <span class="at">detection =</span> detection)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ohun_files/figure-html/unnamed-chunk-21-1.jpeg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>There are two arguments that can deal with this: <code>holdtime</code> and <code>smooth</code>. <code>hold.time</code> allows to merge split sound events that are found within a given time range (in ms). This time range should be high enough to merge things belonging to the same sound event but not too high so it merges different sound events. For this example a <code>hold.time</code> of 200 ms can do the trick (we know gaps between sound events are ~0.5 s long):</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># detect sounds</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>detection <span class="ot">&lt;-</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">energy_detector</span>(</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">files =</span> <span class="st">"simulated_2.wav"</span>,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">threshold =</span> <span class="dv">50</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">min.duration =</span> <span class="dv">1</span>,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="fu">tempdir</span>(),</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">hold.time =</span> <span class="dv">200</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co"># plot spectrogram</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">wave =</span> simulated_2,</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">envelope =</span> <span class="cn">TRUE</span>,</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> <span class="dv">50</span>,</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">detection =</span> detection</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ohun_files/figure-html/unnamed-chunk-22-1.jpeg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
<p><code>smooth</code> works by merging the amplitude envelope ‘hills’ of the split sound events themselves. It smooths envelopes by applying a sliding window averaging of amplitude values. It’s given in ms of the window size. A <code>smooth</code> of 350 ms can merged back split sound events from our example:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># detect sounds</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>detection <span class="ot">&lt;-</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">energy_detector</span>(</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">files =</span> <span class="st">"simulated_2.wav"</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">threshold =</span> <span class="dv">50</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">min.duration =</span> <span class="dv">1</span>,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="fu">tempdir</span>(),</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">smooth =</span> <span class="dv">350</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co"># plot spectrogram</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">wave =</span> simulated_2,</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">envelope =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> <span class="dv">50</span>,</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">detection =</span> detection,</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">smooth =</span> <span class="dv">350</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ohun_files/figure-html/unnamed-chunk-23-1.jpeg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>The function has some additional arguments for further filtering detections (<code>peak.amplitude</code>) and speeding up analysis (<code>thinning</code> and <code>parallel</code>).</p>
<p>&nbsp;</p>
</section>
<section id="optimizing-energy-based-detection" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="optimizing-energy-based-detection"><span class="header-section-number">3.1.2</span> Optimizing energy-based detection</h3>
<p>This last example using <code>smooth</code> can be used to showcase how the tunning parameters can be optimized. As explained above, to do this we need a reference table that contains the time position of the target sound events. The function <code>optimize_energy_detector()</code> can be used finding the optimal parameter values. We must provide the range of parameter values that will be evaluated:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>optim_detection <span class="ot">&lt;-</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">optimize_energy_detector</span>(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">reference =</span> sim2_sel_table,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">files =</span> <span class="st">"simulated_2.wav"</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">threshold =</span> <span class="dv">50</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">min.duration =</span> <span class="dv">1</span>,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="fu">tempdir</span>(),</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">smooth =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">250</span>, <span class="dv">350</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>3 combinations will be evaluated:</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>optim_detection[, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">12</span>, <span class="dv">17</span><span class="sc">:</span><span class="dv">18</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 4%">
<col style="width: 7%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 6%">
<col style="width: 4%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 14%">
<col style="width: 17%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">threshold</th>
<th style="text-align: right;">peak.amplitude</th>
<th style="text-align: right;">smooth</th>
<th style="text-align: right;">hold.time</th>
<th style="text-align: right;">min.duration</th>
<th style="text-align: right;">thinning</th>
<th style="text-align: right;">total.detections</th>
<th style="text-align: right;">true.positives</th>
<th style="text-align: right;">false.positives</th>
<th style="text-align: right;">false.negatives</th>
<th style="text-align: right;">split.positives</th>
<th style="text-align: left;">mean.duration.false.negatives</th>
<th style="text-align: right;">proportional.duration.true.positives</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">50</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">1.000000</td>
</tr>
<tr class="even">
<td style="text-align: right;">50</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">250</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">1.179487</td>
</tr>
<tr class="odd">
<td style="text-align: right;">50</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">350</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">1.000000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>The output contains the combination of parameters used at each iteration as well as the corresponding diagnose indices. In this case all combinations generate a good detection (recall &amp; precision = 1). However, only the routine with the highest <code>smooth</code> (last row) has no split sound events (‘split.positive’ column). It also shows a better overlap to the reference sound events (‘overlap.to.true.positives’ closer to 1).</p>
<p>In addition, there are two complementary functions for optimizing energy-based detection routines: <code>feature_reference()</code> and <code>merge_overlaps()</code>. <code>feature_reference()</code> allow user to get a sense of the time and frequency characteristics of a reference table. This information can be used to determine the range of tuning parameter values during optimization. This is the output of the function applied to <code>lbh_reference</code>:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">feature_reference</span>(<span class="at">reference =</span> lbh_reference, <span class="at">path =</span> <span class="fu">tempdir</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                  min   mean    max
sel.duration   117.96 142.60 163.73
gap.duration   624.97 680.92 811.61
annotations      9.00   9.50  10.00
duty.cycle       0.24   0.27   0.31
peak.amplitude  73.76  81.58  88.03
bottom.freq      1.81   2.11   2.37
top.freq         8.49   8.82   9.53</code></pre>
</div>
</div>
<p>&nbsp;</p>
<p>Features related to selection duration can be used to set the ‘max.duration’ and ‘min.duration’ values, frequency related features can inform banpass values, gap related features inform hold time values and duty cycle can be used to evaluate performance. Peak amplitude can be used to keep only those sound events with the highest intensity, mostly useful for routines in which only a subset of the target sound events present in the recordings is needed.</p>
<p><code>merge_overlaps()</code> finds time-overlapping selections in reference tables and collapses them into a single selection. Overlapping selections would more likely appear as a single amplitude ‘hill’ and thus would be detected as a single sound event. So <code>merge_overlaps()</code> can be useful to prepare references in a format representing a more realistic expectation of how a pefect energy detection routine would look like.</p>
</section>
</section>
<section id="template-based-detection" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="template-based-detection"><span class="header-section-number">3.2</span> Template-based detection</h2>
<p>This detection method is better suited for highly stereotyped sound events. As it doesn’t depend on the signal-to-noise ratio it’s more robust to higher levels of background noise. The procedure is divided in three steps:</p>
<ul>
<li>Choosing the right template (<code>get_templates()</code>)</li>
<li>Estimating the cross-correlation scores of templates along sound files (<code>template_correlator()</code>)<br>
</li>
<li>Detecting sound events by applying a correlation threshold (<code>template_detector()</code>)</li>
</ul>
<p>The function <code>get_templates()</code> can help you find a template closer to the average acoustic structure of the sound events in a reference table. This is done by finding the sound events closer to the centroid of the acoustic space. When the acoustic space is not supplied (‘acoustic.space’ argument) the function estimates it by measuring several acoustic parameters using the function <a href="https://marce10.github.io/warbleR/reference/spectro_analysis.html"><code>spectro_analysis()</code></a> from <a href="https://CRAN.R-project.org/package=warbleR"><code>warbleR</code></a>) and summarizing it with Principal Component Analysis (after z-transforming parameters). If only 1 template is required the function returns the sound event closest to the acoustic space centroid. The rationale here is that a sound event closest to the average sound event structure is more likely to share structural features with most sounds across the acoustic space than a sound event in the periphery of the space. These ‘mean structure’ templates can be obtained as follows:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get mean structure template</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>template <span class="ot">&lt;-</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_templates</span>(<span class="at">reference =</span> lbh1_reference, <span class="at">path =</span> <span class="fu">tempdir</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ohun_files/figure-html/unnamed-chunk-27-1.jpeg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>The graph above shows the overall acoustic spaces, in which the sound closest to the space centroid is highlighted. The highlighted sound is selected as the template and can be used to detect similar sound events. The function <code>get_templates()</code> can also select several templates. This can be helpful when working with sounds that are just moderately stereotyped. This is done by dividing the acoustic space into sub-spaces defined as equal-size slices of a circle centered at the centroid of the acoustic space:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get 3 templates</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">get_templates</span>(<span class="at">reference =</span> lbh_reference, </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">n.sub.spaces =</span> <span class="dv">3</span>, <span class="at">path =</span> <span class="fu">tempdir</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ohun_files/figure-html/unnamed-chunk-29-1.jpeg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>We will use the single template object (‘template’) to run a detection on the example ‘lbh1’ data:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get correlations</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>correlations <span class="ot">&lt;-</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">template_correlator</span>(<span class="at">templates =</span> template,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">files =</span> <span class="st">"lbh1.wav"</span>,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">path =</span> <span class="fu">tempdir</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
<p>The output is an object of class ‘template_correlations’, with its own printing method:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>correlations</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
<p>This object can then be used to detect sound events using <code>template_detector()</code>:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># run detection</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>detection <span class="ot">&lt;-</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">template_detector</span>(<span class="at">template.correlations =</span> correlations, <span class="at">threshold =</span> <span class="fl">0.4</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>detection</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">sound.files</th>
<th style="text-align: right;">selec</th>
<th style="text-align: right;">start</th>
<th style="text-align: right;">end</th>
<th style="text-align: left;">template</th>
<th style="text-align: right;">scores</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">lbh1.wav</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0815573</td>
<td style="text-align: right;">0.2347256</td>
<td style="text-align: left;">lbh1.wav-16</td>
<td style="text-align: right;">0.7158107</td>
</tr>
<tr class="even">
<td style="text-align: left;">lbh1.wav</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.5709008</td>
<td style="text-align: right;">0.7240692</td>
<td style="text-align: left;">lbh1.wav-16</td>
<td style="text-align: right;">0.7245840</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lbh1.wav</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1.0602444</td>
<td style="text-align: right;">1.2134127</td>
<td style="text-align: left;">lbh1.wav-16</td>
<td style="text-align: right;">0.6442318</td>
</tr>
<tr class="even">
<td style="text-align: left;">lbh1.wav</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1.1301507</td>
<td style="text-align: right;">1.2833190</td>
<td style="text-align: left;">lbh1.wav-16</td>
<td style="text-align: right;">0.4265326</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lbh1.wav</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1.3398693</td>
<td style="text-align: right;">1.4930377</td>
<td style="text-align: left;">lbh1.wav-16</td>
<td style="text-align: right;">0.4010336</td>
</tr>
<tr class="even">
<td style="text-align: left;">lbh1.wav</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">1.7127025</td>
<td style="text-align: right;">1.8658709</td>
<td style="text-align: left;">lbh1.wav-16</td>
<td style="text-align: right;">0.7723560</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lbh1.wav</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">2.1903951</td>
<td style="text-align: right;">2.3435634</td>
<td style="text-align: left;">lbh1.wav-16</td>
<td style="text-align: right;">0.6275264</td>
</tr>
<tr class="even">
<td style="text-align: left;">lbh1.wav</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">2.2253482</td>
<td style="text-align: right;">2.3785165</td>
<td style="text-align: left;">lbh1.wav-16</td>
<td style="text-align: right;">0.4237697</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lbh1.wav</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">2.7030407</td>
<td style="text-align: right;">2.8562091</td>
<td style="text-align: left;">lbh1.wav-16</td>
<td style="text-align: right;">0.8026335</td>
</tr>
<tr class="even">
<td style="text-align: left;">lbh1.wav</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">3.1923843</td>
<td style="text-align: right;">3.3455526</td>
<td style="text-align: left;">lbh1.wav-16</td>
<td style="text-align: right;">0.9976684</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lbh1.wav</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">3.2273374</td>
<td style="text-align: right;">3.3805058</td>
<td style="text-align: left;">lbh1.wav-16</td>
<td style="text-align: right;">0.4264247</td>
</tr>
<tr class="even">
<td style="text-align: left;">lbh1.wav</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">3.6817279</td>
<td style="text-align: right;">3.8348962</td>
<td style="text-align: left;">lbh1.wav-16</td>
<td style="text-align: right;">0.7645678</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lbh1.wav</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">3.7166810</td>
<td style="text-align: right;">3.8698493</td>
<td style="text-align: left;">lbh1.wav-16</td>
<td style="text-align: right;">0.4474148</td>
</tr>
<tr class="even">
<td style="text-align: left;">lbh1.wav</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">4.1477694</td>
<td style="text-align: right;">4.3009377</td>
<td style="text-align: left;">lbh1.wav-16</td>
<td style="text-align: right;">0.6407355</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lbh1.wav</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">4.6371130</td>
<td style="text-align: right;">4.7902813</td>
<td style="text-align: left;">lbh1.wav-16</td>
<td style="text-align: right;">0.7392135</td>
</tr>
<tr class="even">
<td style="text-align: left;">lbh1.wav</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">4.6720661</td>
<td style="text-align: right;">4.8252344</td>
<td style="text-align: left;">lbh1.wav-16</td>
<td style="text-align: right;">0.4108326</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>The output can be explored by plotting the spectrogram along with the detection and correlation scores:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot spectrogram</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">wave =</span> lbh1,</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">detection =</span> detection,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">template.correlation =</span> correlations[[<span class="dv">1</span>]],</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">flim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> <span class="fl">0.4</span>,</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">hop.size =</span> <span class="dv">10</span>, <span class="at">ovlp =</span> <span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ohun_files/figure-html/unnamed-chunk-33-1.jpeg" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>The performance can be evaluated using <code>diagnose_detection()</code>:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#diagnose</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">diagnose_detection</span>(<span class="at">reference =</span> lbh1_reference, <span class="at">detection =</span> detection)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 11%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 11%">
<col style="width: 17%">
<col style="width: 4%">
<col style="width: 6%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">total.detections</th>
<th style="text-align: right;">true.positives</th>
<th style="text-align: right;">false.positives</th>
<th style="text-align: right;">false.negatives</th>
<th style="text-align: right;">split.positives</th>
<th style="text-align: right;">merged.positives</th>
<th style="text-align: right;">overlap.to.true.positives</th>
<th style="text-align: right;">recall</th>
<th style="text-align: right;">precision</th>
<th style="text-align: right;">f1.score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.8613333</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.9375</td>
<td style="text-align: right;">0.9677419</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>&nbsp;</p>
<section id="optimizing-template-based-detection" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="optimizing-template-based-detection"><span class="header-section-number">3.2.1</span> Optimizing template-based detection</h3>
<p>The function <code>optimize_template_detector()</code> allows to evaluate the performance under different correlation thresholds:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># run optimization</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>optimization <span class="ot">&lt;-</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">optimize_template_detector</span>(</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">template.correlations =</span> correlations,</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">reference =</span> lbh1_reference,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">threshold =</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.1</span>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>5 thresholds will be evaluated:</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print output</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>optimization</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 15%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">threshold</th>
<th style="text-align: left;">templates</th>
<th style="text-align: right;">total.detections</th>
<th style="text-align: right;">true.positives</th>
<th style="text-align: right;">false.positives</th>
<th style="text-align: right;">false.negatives</th>
<th style="text-align: right;">split.positives</th>
<th style="text-align: right;">merged.positives</th>
<th style="text-align: right;">overlap.to.true.positives</th>
<th style="text-align: right;">recall</th>
<th style="text-align: right;">precision</th>
<th style="text-align: right;">f1.score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.1</td>
<td style="text-align: left;">lbh1.wav-16</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.5105556</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.5567010</td>
<td style="text-align: right;">0.7152318</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">lbh1.wav-16</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.5827500</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.5555556</td>
<td style="text-align: right;">0.7142857</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.3</td>
<td style="text-align: left;">lbh1.wav-16</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.6709375</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.9142857</td>
<td style="text-align: right;">0.9552239</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.4</td>
<td style="text-align: left;">lbh1.wav-16</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.8613333</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.9375000</td>
<td style="text-align: right;">0.9677419</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.5</td>
<td style="text-align: left;">lbh1.wav-16</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.9610000</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: right;">1.0000000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>Additional threshold values can be evaluated without having to run it all over again. We just need to supplied the output from the previous run with the argument <code>previous.output</code> (the same trick can be done when optimizing an energy-based detection):</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># run optimization</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">optimize_template_detector</span>(</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">template.correlations =</span> correlations,</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">reference =</span> lbh1_reference,</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">0.7</span>),</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">previous.output =</span> optimization</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>2 thresholds will be evaluated:</code></pre>
</div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 15%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">threshold</th>
<th style="text-align: left;">templates</th>
<th style="text-align: right;">total.detections</th>
<th style="text-align: right;">true.positives</th>
<th style="text-align: right;">false.positives</th>
<th style="text-align: right;">false.negatives</th>
<th style="text-align: right;">split.positives</th>
<th style="text-align: right;">merged.positives</th>
<th style="text-align: right;">overlap.to.true.positives</th>
<th style="text-align: right;">recall</th>
<th style="text-align: right;">precision</th>
<th style="text-align: right;">f1.score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.1</td>
<td style="text-align: left;">lbh1.wav-16</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.5105556</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">0.5567010</td>
<td style="text-align: right;">0.7152318</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">lbh1.wav-16</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.5827500</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">0.5555556</td>
<td style="text-align: right;">0.7142857</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.3</td>
<td style="text-align: left;">lbh1.wav-16</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.6709375</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">0.9142857</td>
<td style="text-align: right;">0.9552239</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.4</td>
<td style="text-align: left;">lbh1.wav-16</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.8613333</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">0.9375000</td>
<td style="text-align: right;">0.9677419</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.5</td>
<td style="text-align: left;">lbh1.wav-16</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.9610000</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: right;">1.0000000</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.6</td>
<td style="text-align: left;">lbh1.wav-16</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.9610000</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: right;">1.0000000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.7</td>
<td style="text-align: left;">lbh1.wav-16</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.9542857</td>
<td style="text-align: right;">0.7</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: right;">0.8235294</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>In this case several threshold values can achieved an optimal detection.</p>
<p>&nbsp;</p>
</section>
<section id="detecting-several-templates" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="detecting-several-templates"><span class="header-section-number">3.2.2</span> Detecting several templates</h3>
<p>Several templates can be used within the same call. Here we correlate two templates on the two example sound files, taking one template from each sound file:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get correlations</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>correlations <span class="ot">&lt;-</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">template_correlator</span>(</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">templates =</span> lbh_reference[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>),],</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">files =</span> <span class="fu">c</span>(<span class="st">"lbh1.wav"</span>, <span class="st">"lbh2.wav"</span>),</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="fu">tempdir</span>()</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="co"># run detection</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>detection <span class="ot">&lt;-</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">template_detector</span>(<span class="at">template.correlations =</span> correlations, <span class="at">threshold =</span> <span class="fl">0.5</span>)</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>correlations <span class="ot">&lt;-</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">template_correlator</span>(</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">templates =</span> lbh_reference[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>),],</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">files =</span> <span class="fu">c</span>(<span class="st">"lbh1.wav"</span>, <span class="st">"lbh2.wav"</span>),</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="fu">tempdir</span>()</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>&nbsp;</p>
<p>Note that in these cases we can get the same sound event detected several times (duplicates), one by each template. We can check if that is the case just by diagnosing the detection:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">#diagnose</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">diagnose_detection</span>(<span class="at">reference =</span> lbh_reference, <span class="at">detection =</span> detection)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 11%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 11%">
<col style="width: 17%">
<col style="width: 4%">
<col style="width: 6%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">total.detections</th>
<th style="text-align: right;">true.positives</th>
<th style="text-align: right;">false.positives</th>
<th style="text-align: right;">false.negatives</th>
<th style="text-align: right;">split.positives</th>
<th style="text-align: right;">merged.positives</th>
<th style="text-align: right;">overlap.to.true.positives</th>
<th style="text-align: right;">recall</th>
<th style="text-align: right;">precision</th>
<th style="text-align: right;">f1.score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">23</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.9573913</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>Duplicates are shown as split positives. Fortunately, we can leave a single detected sound event by leaving only those with the highest correlation. To do this we first need to label each row in the detection using <code>label_detection()</code> and then remove duplicates using <code>filter_detection()</code>:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># labeling detection</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>labeled <span class="ot">&lt;-</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">label_detection</span>(<span class="at">reference =</span> lbh_reference, <span class="at">detection =</span> detection)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This function adds a column (‘detection.class’) with the class label for each row:</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(labeled<span class="sc">$</span>detection.class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
        true.positive true.positive (split) 
                   15                     8 </code></pre>
</div>
</div>
<p>&nbsp;</p>
<p>Now we can filter out duplicates and diagnose the detection again, telling the function to select a single row per duplicate using the correlation score as a criterium (<code>by = "scores"</code>, this column is part of the <code>template_detector()</code> output):</p>
<div class="cell" data-layout-align="center">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># filter</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>filtered <span class="ot">&lt;-</span> <span class="fu">filter_detection</span>(<span class="at">detection =</span> labeled, <span class="at">by =</span> <span class="st">"scores"</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co"># diagnose</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="fu">diagnose_detection</span>(<span class="at">reference =</span> lbh_reference, <span class="at">detection =</span> filtered)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 11%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 11%">
<col style="width: 17%">
<col style="width: 4%">
<col style="width: 6%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">total.detections</th>
<th style="text-align: right;">true.positives</th>
<th style="text-align: right;">false.positives</th>
<th style="text-align: right;">false.negatives</th>
<th style="text-align: right;">split.positives</th>
<th style="text-align: right;">merged.positives</th>
<th style="text-align: right;">overlap.to.true.positives</th>
<th style="text-align: right;">recall</th>
<th style="text-align: right;">precision</th>
<th style="text-align: right;">f1.score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">19</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>We successfully get rid of duplicates and detected every single target sound event.</p>
<hr>
</section>
</section>
<section id="improving-detection-speed" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="improving-detection-speed"><span class="header-section-number">3.3</span> Improving detection speed</h2>
<p>Detection routines can take a long time when working with large amounts of acoustic data (e.g.&nbsp;large sound files and/or many sound files). These are some useful points to keep in mine when trying to make a routine more time-efficient:</p>
<ul>
<li>Always test procedures on small data subsets</li>
<li><code>template_detector()</code> is faster than <code>energy_detector()</code></li>
<li>Parallelization (see <code>parallel</code> argument in most functions) can significantly speed-up routines, but works better on Unix-based operating systems (linux and mac OS)</li>
<li>Sampling rate matters: detecting sound events on low sampling rate files goes faster, so we should avoid having nyquist frequencies (sampling rate / 2) way higher than the highest frequency of the target sound events (sound files can be downsampled using warbleR’s <a href="https://marce10.github.io/warbleR/reference/selection_table.html"><code>fix_sound_files()</code></a>)</li>
<li>Large sound files can make the routine crash, use <code>split_acoustic_data()</code> to split both reference tables and files into shorter clips.</li>
<li>Think about using a computer with lots of RAM memory or a computer cluster for working on large amounts of data</li>
<li><code>thinning</code> argument (which reduces the size of the amplitude envelope) can also speed-up <code>energy_detector()</code></li>
</ul>
<p>&nbsp;</p>
<hr>
</section>
<section id="additional-tips" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="additional-tips"><span class="header-section-number">3.4</span> Additional tips</h2>
<ul>
<li>Use your knowledge about the sound event structure to determine the initial range for the tuning parameters in a detection optimization routine</li>
<li>If people have a hard time figuring out where a target sound event occurs in a recording, detection algorithms will also have a hard time</li>
<li>Several templates representing the range of variation in sound event structure can be used to detect semi-stereotyped sound events</li>
<li>Make sure reference tables contain all target sound events and only the target sound events. The performance of the detection cannot be better than the reference itself.</li>
<li>Avoid having overlapping sound events or several sound events as a single one (like a multi-syllable vocalization) in the reference table when running an energy-based detector</li>
<li>Low-precision can be improved by training a classification model (e.g.&nbsp;random forest) to tell sound events from noise</li>
</ul>
<hr>
<div class="alert alert-info">
<p>Please cite <a href="https://github.com/maRce10/ohun">ohun</a> like this:</p>
<p>Araya-Salas, M. (2021), <em>ohun: diagnosing and optimizing automated sound event detection</em>. R package version 0.1.0.</p>
</div>
<p>&nbsp;</p>
</section>
<section id="references" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="references"><span class="header-section-number">3.5</span> References</h2>
<ol type="1">
<li>Araya-Salas, M. (2021), ohun: diagnosing and optimizing automated sound event detection. R package version 0.1.0.</li>
<li>Araya-Salas M, Smith-Vidaurre G (2017) warbleR: An R package to streamline analysis of animal sound events. Methods Ecol Evol 8:184-191.</li>
<li>Khanna H., Gaunt S.L.L. &amp; McCallum D.A. (1997). Digital spectrographic cross-correlation: tests of sensitivity. Bioacoustics 7(3): 209-234.</li>
<li>Knight, E.C., Hannah, K.C., Foley, G.J., Scott, C.D., Brigham, R.M. &amp; Bayne, E. (2017). Recommendations for acoustic recognizer performance assessment with application to five common automated signal recognition programs. Avian Conservation and Ecology,</li>
<li>Macmillan, N. A., &amp; Creelman, C.D. (2004). Detection theory: A user’s guide. Psychology press.</li>
</ol>
<p>&nbsp;</p>
<hr>
<p><font size="4">Session information</font></p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.2.2 Patched (2022-11-10 r83330)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 20.04.5 LTS

Matrix products: default
BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.9.0
LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.9.0

locale:
 [1] LC_CTYPE=es_ES.UTF-8       LC_NUMERIC=C               LC_TIME=es_CR.UTF-8       
 [4] LC_COLLATE=es_ES.UTF-8     LC_MONETARY=es_CR.UTF-8    LC_MESSAGES=es_ES.UTF-8   
 [7] LC_PAPER=es_CR.UTF-8       LC_NAME=C                  LC_ADDRESS=C              
[10] LC_TELEPHONE=C             LC_MEASUREMENT=es_CR.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] ohun_0.1.1         warbleR_1.1.28     NatureSounds_1.0.4 knitr_1.42        
[5] seewave_2.2.0      tuneR_1.4.4       

loaded via a namespace (and not attached):
 [1] Rcpp_1.0.10        class_7.3-21       fftw_1.0-7         digest_0.6.31     
 [5] foreach_1.5.2      utf8_1.2.3         R6_2.5.1           Sim.DiffProc_4.8  
 [9] signal_0.7-7       evaluate_0.21      e1071_1.7-12       ggplot2_3.4.2     
[13] pillar_1.9.0       rlang_1.1.1        rstudioapi_0.14    rmarkdown_2.21    
[17] htmlwidgets_1.5.4  igraph_1.3.5       RCurl_1.98-1.12    munsell_0.5.0     
[21] proxy_0.4-27       compiler_4.2.2     Deriv_4.1.3        xfun_0.39         
[25] pkgconfig_2.0.3    htmltools_0.5.5    tidyselect_1.2.0   tibble_3.2.1      
[29] gridExtra_2.3      codetools_0.2-19   dtw_1.23-1         fansi_1.0.4       
[33] viridisLite_0.4.2  dplyr_1.1.0        sf_1.0-9           shinyBS_0.61.1    
[37] MASS_7.3-58.2      bitops_1.0-7       brio_1.1.3         grid_4.2.2        
[41] jsonlite_1.8.4     gtable_0.3.3       lifecycle_1.0.3    DBI_1.1.3         
[45] magrittr_2.0.3     units_0.8-1        scales_1.2.1       KernSmooth_2.23-20
[49] cli_3.6.1          pbapply_1.7-0      viridis_0.6.3      testthat_3.1.8    
[53] generics_0.1.3     vctrs_0.6.2        rjson_0.2.21       iterators_1.0.14  
[57] tools_4.2.2        glue_1.6.2         parallel_4.2.2     fastmap_1.1.1     
[61] yaml_2.3.7         colorspace_2.1-0   soundgen_2.5.3     classInt_0.4-8    </code></pre>
</div>
</div>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp(/https:\/\/marce10\.github\.io\/OTS_BIR_2023\//);
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          // default icon
          link.classList.add("external");
      }
    }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb51" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> &lt;font size="7"&gt;&lt;b&gt;&lt;i&gt;ohun&lt;/i&gt;&amp;#x3A; optimizing acoustic signal detection&lt;/b&gt;&lt;/font&gt;</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="an">toc:</span><span class="co"> true</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="an">toc-depth:</span><span class="co"> 2</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="an">toc-location:</span><span class="co"> left</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="an">number-sections:</span><span class="co"> true</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="an">highlight-style:</span><span class="co"> pygments</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="co">    df-print: kable</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: show</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="co">    css: styles.css</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a><span class="co">    link-external-icon: true</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="co">    link-external-newwindow: true  </span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a><span class="co">  chunk_output_type: console</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>::: {.alert .alert-info}</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a><span class="fu">## **Objetive** {.unnumbered .unlisted}</span></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Get familiar with concepts and data formatting practices related to automatic acoustic signals detection</span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Learn how to run automatic detection using the package ohun</span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">ohun</span><span class="co">](https://github.com/maRce10/ohun)</span> is intended to facilitate the automated detection of sound events, providing functions to diagnose and optimize detection routines. Detections from other software can also be explored and optimized.</span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a>::: {.alert .alert-info}</span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;font</span> <span class="er">size</span> <span class="ot">=</span> <span class="st">"4"</span><span class="kw">&gt;</span>The main features of the package are: <span class="kw">&lt;/font&gt;</span></span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-37"><a href="#cb51-37" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The use of reference annotations for detection optimization and diagnostic</span>
<span id="cb51-38"><a href="#cb51-38" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The use of signal detection theory indices to evaluate detection performance</span>
<span id="cb51-39"><a href="#cb51-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-40"><a href="#cb51-40" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-41"><a href="#cb51-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-42"><a href="#cb51-42" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;font</span> <span class="er">size</span> <span class="ot">=</span> <span class="st">"4"</span><span class="kw">&gt;</span>The package offers functions for: <span class="kw">&lt;/font&gt;</span></span>
<span id="cb51-43"><a href="#cb51-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-44"><a href="#cb51-44" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Curate references and acoustic data sets</span>
<span id="cb51-45"><a href="#cb51-45" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Diagnose detection performance</span>
<span id="cb51-46"><a href="#cb51-46" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Optimize detection routines based on reference annotations</span>
<span id="cb51-47"><a href="#cb51-47" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Energy-based detection</span>
<span id="cb51-48"><a href="#cb51-48" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Template-based detection</span>
<span id="cb51-49"><a href="#cb51-49" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb51-50"><a href="#cb51-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-51"><a href="#cb51-51" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-52"><a href="#cb51-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-53"><a href="#cb51-53" aria-hidden="true" tabindex="-1"></a>All functions allow the parallelization of tasks, which distributes the tasks among several processors to improve computational efficiency. The package works on sound files in '.wav', '.mp3', '.flac' and '.wac' format.</span>
<span id="cb51-54"><a href="#cb51-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-55"><a href="#cb51-55" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb51-56"><a href="#cb51-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-57"><a href="#cb51-57" aria-hidden="true" tabindex="-1"></a>To install the latest developmental version from <span class="co">[</span><span class="ot">github</span><span class="co">](https://github.com/)</span> you will need the R package <span class="co">[</span><span class="ot">remotes</span><span class="co">](https://cran.r-project.org/package=devtools)</span>:</span>
<span id="cb51-58"><a href="#cb51-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-59"><a href="#cb51-59" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb51-60"><a href="#cb51-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-61"><a href="#cb51-61" aria-hidden="true" tabindex="-1"></a><span class="co"># install pacakge</span></span>
<span id="cb51-62"><a href="#cb51-62" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"maRce10/ohun"</span>)</span>
<span id="cb51-63"><a href="#cb51-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-64"><a href="#cb51-64" aria-hidden="true" tabindex="-1"></a><span class="co">#load package</span></span>
<span id="cb51-65"><a href="#cb51-65" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ohun)</span>
<span id="cb51-66"><a href="#cb51-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-67"><a href="#cb51-67" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-68"><a href="#cb51-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-69"><a href="#cb51-69" aria-hidden="true" tabindex="-1"></a><span class="in">```{r global options, echo = FALSE, message=FALSE, warning=FALSE}</span></span>
<span id="cb51-70"><a href="#cb51-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-71"><a href="#cb51-71" aria-hidden="true" tabindex="-1"></a><span class="co">#load package</span></span>
<span id="cb51-72"><a href="#cb51-72" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ohun)</span>
<span id="cb51-73"><a href="#cb51-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-74"><a href="#cb51-74" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(lbh2)</span>
<span id="cb51-75"><a href="#cb51-75" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(lbh1)</span>
<span id="cb51-76"><a href="#cb51-76" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(lbh_reference)</span>
<span id="cb51-77"><a href="#cb51-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-78"><a href="#cb51-78" aria-hidden="true" tabindex="-1"></a><span class="co"># for spectrograms</span></span>
<span id="cb51-79"><a href="#cb51-79" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">2</span>) <span class="sc">+</span> <span class="fl">0.1</span>)</span>
<span id="cb51-80"><a href="#cb51-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-81"><a href="#cb51-81" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">require</span>(knitr))</span>
<span id="cb51-82"><a href="#cb51-82" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">width =</span> <span class="dv">90</span>)</span>
<span id="cb51-83"><a href="#cb51-83" aria-hidden="true" tabindex="-1"></a>opts_chunk<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb51-84"><a href="#cb51-84" aria-hidden="true" tabindex="-1"></a>  <span class="at">comment =</span> <span class="cn">NA</span>,</span>
<span id="cb51-85"><a href="#cb51-85" aria-hidden="true" tabindex="-1"></a>  <span class="at">message =</span> <span class="cn">FALSE</span>,</span>
<span id="cb51-86"><a href="#cb51-86" aria-hidden="true" tabindex="-1"></a>  <span class="at">warning =</span> <span class="cn">FALSE</span>,</span>
<span id="cb51-87"><a href="#cb51-87" aria-hidden="true" tabindex="-1"></a>  <span class="co"># eval = if (isTRUE(exists("params"))) params$EVAL else FALSE,</span></span>
<span id="cb51-88"><a href="#cb51-88" aria-hidden="true" tabindex="-1"></a>  <span class="at">dev =</span> <span class="st">"jpeg"</span>,</span>
<span id="cb51-89"><a href="#cb51-89" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpi =</span> <span class="dv">100</span>,</span>
<span id="cb51-90"><a href="#cb51-90" aria-hidden="true" tabindex="-1"></a>  <span class="at">fig.asp =</span> <span class="fl">0.4</span>,</span>
<span id="cb51-91"><a href="#cb51-91" aria-hidden="true" tabindex="-1"></a>  <span class="at">fig.width =</span> <span class="fl">6.5</span>,</span>
<span id="cb51-92"><a href="#cb51-92" aria-hidden="true" tabindex="-1"></a>  <span class="at">out.width =</span> <span class="st">"100%"</span>,</span>
<span id="cb51-93"><a href="#cb51-93" aria-hidden="true" tabindex="-1"></a>  <span class="at">fig.align =</span> <span class="st">"center"</span></span>
<span id="cb51-94"><a href="#cb51-94" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-95"><a href="#cb51-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-96"><a href="#cb51-96" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-97"><a href="#cb51-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-98"><a href="#cb51-98" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-99"><a href="#cb51-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-100"><a href="#cb51-100" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb51-101"><a href="#cb51-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-102"><a href="#cb51-102" aria-hidden="true" tabindex="-1"></a><span class="fu"># Automatic sound event detection</span></span>
<span id="cb51-103"><a href="#cb51-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-104"><a href="#cb51-104" aria-hidden="true" tabindex="-1"></a>Finding the position of sound events in a sound file is a challenging task. <span class="co">[</span><span class="ot">ohun</span><span class="co">](https://github.com/maRce10/ohun)</span> offers two methods for automated sound event detection: template-based and energy-based detection. These methods are better suited for highly stereotyped or good signal-to-noise ratio (SNR) sounds, respectively. If the target sound events don't fit these requirements, more elaborated methods (i.e. machine learning approaches) are warranted:</span>
<span id="cb51-105"><a href="#cb51-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-106"><a href="#cb51-106" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;figure&gt;</span></span>
<span id="cb51-107"><a href="#cb51-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-108"><a href="#cb51-108" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;center&gt;&lt;img</span> <span class="er">src</span><span class="ot">=</span><span class="st">"images/analysis_workflow.png"</span> <span class="er">alt</span><span class="ot">=</span><span class="st">"automated signal detection diagram"</span> <span class="er">width</span><span class="ot">=</span><span class="st">"500"</span> <span class="er">height</span><span class="ot">=</span><span class="st">"450"</span><span class="kw">/&gt;&lt;/center&gt;</span></span>
<span id="cb51-109"><a href="#cb51-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-110"><a href="#cb51-110" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;figcaption&gt;&lt;i&gt;</span>Diagram depicting how target sound event features can be used to tell the most adequate sound event detection approach. Steps in which 'ohun' can be helpful are shown in color. (SNR = signal-to-noise ratio) <span class="kw">&lt;/i&gt;&lt;/figcaption&gt;</span></span>
<span id="cb51-111"><a href="#cb51-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-112"><a href="#cb51-112" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/figure&gt;</span></span>
<span id="cb51-113"><a href="#cb51-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-114"><a href="#cb51-114" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-115"><a href="#cb51-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-116"><a href="#cb51-116" aria-hidden="true" tabindex="-1"></a>Still, a detection run using other software can be optimized with the tools provided in <span class="co">[</span><span class="ot">ohun</span><span class="co">](https://github.com/maRce10/ohun)</span>.</span>
<span id="cb51-117"><a href="#cb51-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-118"><a href="#cb51-118" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-119"><a href="#cb51-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-120"><a href="#cb51-120" aria-hidden="true" tabindex="-1"></a><span class="fu"># Signal detection theory applied to bioacoustics</span></span>
<span id="cb51-121"><a href="#cb51-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-122"><a href="#cb51-122" aria-hidden="true" tabindex="-1"></a>Broadly speaking, signal detection theory deals with the process of recovering signals (i.e. target signals) from background noise (not necessarily acoustic noise) and it's widely used for optimizing this decision making process in the presence of uncertainty. During a detection routine, the detected 'items' can be classified into 4 classes:</span>
<span id="cb51-123"><a href="#cb51-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-124"><a href="#cb51-124" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**True positives (TPs)**: signals correctly identified as 'signal'</span>
<span id="cb51-125"><a href="#cb51-125" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**False positives (FPs)**: background noise incorrectly identified as 'signal'</span>
<span id="cb51-126"><a href="#cb51-126" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**False negatives (FNs)**: signals incorrectly identified as 'background noise'</span>
<span id="cb51-127"><a href="#cb51-127" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**True negatives (TNs)**: background noise correctly identified as 'background noise'</span>
<span id="cb51-128"><a href="#cb51-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-129"><a href="#cb51-129" aria-hidden="true" tabindex="-1"></a>Several additional indices derived from these indices are used to evaluate the performance of a detection routine. These are three useful indices in the context of sound event detection included in <span class="co">[</span><span class="ot">ohun</span><span class="co">](https://github.com/maRce10/ohun)</span>:</span>
<span id="cb51-130"><a href="#cb51-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-131"><a href="#cb51-131" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Recall**: correct detections relative to total references (a.k.a. true positive rate or sensitivity; *TPs / (TPs + FNs)*)</span>
<span id="cb51-132"><a href="#cb51-132" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Precision**: correct detections relative to total detections (*TPs / (TPs + FPs)*).</span>
<span id="cb51-133"><a href="#cb51-133" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**F1 score**: combines recall and precision as the harmonic mean of these two, so it provides a single value for evaluating performance (a.k.a. F-measure or Dice similarity coefficient).</span>
<span id="cb51-134"><a href="#cb51-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-135"><a href="#cb51-135" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;font</span> <span class="er">size</span> <span class="ot">=</span> <span class="st">"2"</span><span class="kw">&gt;</span>*(Metrics that make use of 'true negatives' cannot be easily applied in the context of sound event detection as noise cannot always be partitioned in discrete units)*<span class="kw">&lt;/font&gt;</span></span>
<span id="cb51-136"><a href="#cb51-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-137"><a href="#cb51-137" aria-hidden="true" tabindex="-1"></a>A perfect detection will have no false positives or false negatives, which will result in both recall and precision equal to 1. However, perfect detection cannot always be reached and some compromise between detecting all target signals plus some noise (recall = 1 &amp; precision <span class="sc">\&lt;</span> 1) and detecting only target signals but not all of them (recall <span class="sc">\&lt;</span> 1 &amp; precision = 1) is warranted. The right balance between these two extremes will be given by the relative costs of missing signals and mistaking noise for signals. Hence, these indices provide an useful framework for diagnosing and optimizing the performance of a detection routine.</span>
<span id="cb51-138"><a href="#cb51-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-139"><a href="#cb51-139" aria-hidden="true" tabindex="-1"></a>The package <span class="co">[</span><span class="ot">ohun</span><span class="co">](https://github.com/maRce10/ohun)</span> provides a set of tools to evaluate the performance of an sound event detection based on the indices described above. To accomplish this, the result of a detection routine is compared against a reference table containing the time position of all target sound events in the sound files. The package comes with an example reference table containing annotations of long-billed hermit hummingbird songs from two sound files (also supplied as example data: 'lbh1' and 'lbh2'), which can be used to illustrate detection performance evaluation. The example data can be explored as follows:</span>
<span id="cb51-140"><a href="#cb51-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-141"><a href="#cb51-141" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = TRUE, }</span></span>
<span id="cb51-142"><a href="#cb51-142" aria-hidden="true" tabindex="-1"></a><span class="co"># load example data</span></span>
<span id="cb51-143"><a href="#cb51-143" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"lbh1"</span>, <span class="st">"lbh2"</span>, <span class="st">"lbh_reference"</span>)</span>
<span id="cb51-144"><a href="#cb51-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-145"><a href="#cb51-145" aria-hidden="true" tabindex="-1"></a>lbh_reference</span>
<span id="cb51-146"><a href="#cb51-146" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-147"><a href="#cb51-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-148"><a href="#cb51-148" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-149"><a href="#cb51-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-150"><a href="#cb51-150" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-151"><a href="#cb51-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-152"><a href="#cb51-152" aria-hidden="true" tabindex="-1"></a>All <span class="co">[</span><span class="ot">ohun</span><span class="co">](https://github.com/maRce10/ohun)</span> functions that work with this kind of data can take both selection tables and data frames. Spectrograms with highlighted sound events from a selection table can be plotted with the function <span class="in">`label_spectro()`</span> (this function only plots one wave object at the time):</span>
<span id="cb51-153"><a href="#cb51-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-154"><a href="#cb51-154" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = TRUE}</span></span>
<span id="cb51-155"><a href="#cb51-155" aria-hidden="true" tabindex="-1"></a><span class="co"># save sound file</span></span>
<span id="cb51-156"><a href="#cb51-156" aria-hidden="true" tabindex="-1"></a><span class="fu">writeWave</span>(lbh1, <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">"lbh1.wav"</span>))</span>
<span id="cb51-157"><a href="#cb51-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-158"><a href="#cb51-158" aria-hidden="true" tabindex="-1"></a><span class="co"># save sound file</span></span>
<span id="cb51-159"><a href="#cb51-159" aria-hidden="true" tabindex="-1"></a><span class="fu">writeWave</span>(lbh2, <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">"lbh2.wav"</span>))</span>
<span id="cb51-160"><a href="#cb51-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-161"><a href="#cb51-161" aria-hidden="true" tabindex="-1"></a><span class="co"># print spectrogram</span></span>
<span id="cb51-162"><a href="#cb51-162" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(</span>
<span id="cb51-163"><a href="#cb51-163" aria-hidden="true" tabindex="-1"></a>  <span class="at">wave =</span> lbh1,</span>
<span id="cb51-164"><a href="#cb51-164" aria-hidden="true" tabindex="-1"></a>  <span class="at">reference =</span> lbh_reference[lbh_reference<span class="sc">$</span>sound.files <span class="sc">==</span> <span class="st">"lbh1.wav"</span>,],</span>
<span id="cb51-165"><a href="#cb51-165" aria-hidden="true" tabindex="-1"></a>  <span class="at">hop.size =</span> <span class="dv">10</span>,</span>
<span id="cb51-166"><a href="#cb51-166" aria-hidden="true" tabindex="-1"></a>  <span class="at">ovlp =</span> <span class="dv">50</span>,</span>
<span id="cb51-167"><a href="#cb51-167" aria-hidden="true" tabindex="-1"></a>  <span class="at">flim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb51-168"><a href="#cb51-168" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-169"><a href="#cb51-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-170"><a href="#cb51-170" aria-hidden="true" tabindex="-1"></a><span class="co"># print spectrogram</span></span>
<span id="cb51-171"><a href="#cb51-171" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(</span>
<span id="cb51-172"><a href="#cb51-172" aria-hidden="true" tabindex="-1"></a>  <span class="at">wave =</span> lbh2,</span>
<span id="cb51-173"><a href="#cb51-173" aria-hidden="true" tabindex="-1"></a>  <span class="at">reference =</span> lbh_reference[lbh_reference<span class="sc">$</span>sound.files <span class="sc">==</span> <span class="st">"lbh2.wav"</span>,],</span>
<span id="cb51-174"><a href="#cb51-174" aria-hidden="true" tabindex="-1"></a>  <span class="at">hop.size =</span> <span class="dv">10</span>,</span>
<span id="cb51-175"><a href="#cb51-175" aria-hidden="true" tabindex="-1"></a>  <span class="at">ovlp =</span> <span class="dv">50</span>,</span>
<span id="cb51-176"><a href="#cb51-176" aria-hidden="true" tabindex="-1"></a>  <span class="at">flim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb51-177"><a href="#cb51-177" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-178"><a href="#cb51-178" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-179"><a href="#cb51-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-180"><a href="#cb51-180" aria-hidden="true" tabindex="-1"></a>The function <span class="in">`diagnose_detection()`</span> evaluates the performance of a detection routine by comparing it to a reference table. For instance, a perfect detection is given by comparing <span class="in">`lbh_reference`</span> to itself:</span>
<span id="cb51-181"><a href="#cb51-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-184"><a href="#cb51-184" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-185"><a href="#cb51-185" aria-hidden="true" tabindex="-1"></a>lbh1_reference <span class="ot">&lt;-</span></span>
<span id="cb51-186"><a href="#cb51-186" aria-hidden="true" tabindex="-1"></a>  lbh_reference[lbh_reference<span class="sc">$</span>sound.files <span class="sc">==</span> <span class="st">"lbh1.wav"</span>,]</span>
<span id="cb51-187"><a href="#cb51-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-188"><a href="#cb51-188" aria-hidden="true" tabindex="-1"></a><span class="co"># diagnose</span></span>
<span id="cb51-189"><a href="#cb51-189" aria-hidden="true" tabindex="-1"></a><span class="fu">diagnose_detection</span>(<span class="at">reference =</span> lbh1_reference, </span>
<span id="cb51-190"><a href="#cb51-190" aria-hidden="true" tabindex="-1"></a>                   <span class="at">detection =</span> lbh1_reference)[, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)]</span>
<span id="cb51-191"><a href="#cb51-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-192"><a href="#cb51-192" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-193"><a href="#cb51-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-194"><a href="#cb51-194" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-195"><a href="#cb51-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-196"><a href="#cb51-196" aria-hidden="true" tabindex="-1"></a>We will work mostly with a single sound file for convenience but the functions can work on several sound files at the time. The files should be found in a single working directory. Although the above example is a bit silly, it shows the basic diagnostic indices, which include basic detection theory indices ('true.positives', 'false.positives', 'false.negatives', 'recall' and 'precision') mentioned above. We can play around with the reference table to see how these indices can be used to spot imperfect detection routines (and hopefully improve them!). For instance, we can remove some sound events to see how this is reflected in the diagnostics. Getting rid of some rows in 'detection', simulating a detection with some false negatives, will affect the recall but not the precision:</span>
<span id="cb51-197"><a href="#cb51-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-200"><a href="#cb51-200" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-201"><a href="#cb51-201" aria-hidden="true" tabindex="-1"></a><span class="co"># create new table</span></span>
<span id="cb51-202"><a href="#cb51-202" aria-hidden="true" tabindex="-1"></a>lbh1_detection <span class="ot">&lt;-</span> lbh1_reference[<span class="dv">3</span><span class="sc">:</span><span class="dv">9</span>, ]</span>
<span id="cb51-203"><a href="#cb51-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-204"><a href="#cb51-204" aria-hidden="true" tabindex="-1"></a><span class="co"># print spectrogram</span></span>
<span id="cb51-205"><a href="#cb51-205" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(</span>
<span id="cb51-206"><a href="#cb51-206" aria-hidden="true" tabindex="-1"></a>  <span class="at">wave =</span> lbh1,</span>
<span id="cb51-207"><a href="#cb51-207" aria-hidden="true" tabindex="-1"></a>  <span class="at">reference =</span> lbh1_reference,</span>
<span id="cb51-208"><a href="#cb51-208" aria-hidden="true" tabindex="-1"></a>  <span class="at">detection =</span> lbh1_detection,</span>
<span id="cb51-209"><a href="#cb51-209" aria-hidden="true" tabindex="-1"></a>  <span class="at">hop.size =</span> <span class="dv">10</span>,</span>
<span id="cb51-210"><a href="#cb51-210" aria-hidden="true" tabindex="-1"></a>  <span class="at">ovlp =</span> <span class="dv">50</span>,</span>
<span id="cb51-211"><a href="#cb51-211" aria-hidden="true" tabindex="-1"></a>  <span class="at">flim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb51-212"><a href="#cb51-212" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-213"><a href="#cb51-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-214"><a href="#cb51-214" aria-hidden="true" tabindex="-1"></a><span class="co"># diagnose</span></span>
<span id="cb51-215"><a href="#cb51-215" aria-hidden="true" tabindex="-1"></a><span class="fu">diagnose_detection</span>(<span class="at">reference =</span> lbh1_reference, </span>
<span id="cb51-216"><a href="#cb51-216" aria-hidden="true" tabindex="-1"></a>                   <span class="at">detection =</span> lbh1_detection)[, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)]</span>
<span id="cb51-217"><a href="#cb51-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-218"><a href="#cb51-218" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-219"><a href="#cb51-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-220"><a href="#cb51-220" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-221"><a href="#cb51-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-222"><a href="#cb51-222" aria-hidden="true" tabindex="-1"></a>Having some additional sound events not in reference will do the opposite, reducing precision but not recall. We can do this simply by switching the tables:</span>
<span id="cb51-223"><a href="#cb51-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-224"><a href="#cb51-224" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, }</span></span>
<span id="cb51-225"><a href="#cb51-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-226"><a href="#cb51-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-227"><a href="#cb51-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-228"><a href="#cb51-228" aria-hidden="true" tabindex="-1"></a><span class="co"># print spectrogram</span></span>
<span id="cb51-229"><a href="#cb51-229" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(</span>
<span id="cb51-230"><a href="#cb51-230" aria-hidden="true" tabindex="-1"></a>  <span class="at">wave =</span> lbh1,</span>
<span id="cb51-231"><a href="#cb51-231" aria-hidden="true" tabindex="-1"></a>  <span class="at">detection =</span> lbh1_reference,</span>
<span id="cb51-232"><a href="#cb51-232" aria-hidden="true" tabindex="-1"></a>  <span class="at">reference =</span> lbh1_detection,</span>
<span id="cb51-233"><a href="#cb51-233" aria-hidden="true" tabindex="-1"></a>  <span class="at">hop.size =</span> <span class="dv">10</span>,</span>
<span id="cb51-234"><a href="#cb51-234" aria-hidden="true" tabindex="-1"></a>  <span class="at">ovlp =</span> <span class="dv">50</span>,</span>
<span id="cb51-235"><a href="#cb51-235" aria-hidden="true" tabindex="-1"></a>  <span class="at">flim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb51-236"><a href="#cb51-236" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-237"><a href="#cb51-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-238"><a href="#cb51-238" aria-hidden="true" tabindex="-1"></a><span class="co"># diagnose</span></span>
<span id="cb51-239"><a href="#cb51-239" aria-hidden="true" tabindex="-1"></a><span class="fu">diagnose_detection</span>(<span class="at">reference =</span> lbh1_detection, </span>
<span id="cb51-240"><a href="#cb51-240" aria-hidden="true" tabindex="-1"></a>                   <span class="at">detection =</span> lbh1_reference)[, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)]</span>
<span id="cb51-241"><a href="#cb51-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-242"><a href="#cb51-242" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-243"><a href="#cb51-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-244"><a href="#cb51-244" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-245"><a href="#cb51-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-246"><a href="#cb51-246" aria-hidden="true" tabindex="-1"></a>The function offers three additional diagnose metrics:</span>
<span id="cb51-247"><a href="#cb51-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-248"><a href="#cb51-248" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Split positives**: target sound events overlapped by more than 1 detecion</span>
<span id="cb51-249"><a href="#cb51-249" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Merged positives**: number of cases in which 2 or more target sound events in 'reference' were overlapped by the same detection</span>
<span id="cb51-250"><a href="#cb51-250" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Proportional overlap of true positives**: ratio of the time overlap of true positives with its corresponding sound event in the reference table</span>
<span id="cb51-251"><a href="#cb51-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-252"><a href="#cb51-252" aria-hidden="true" tabindex="-1"></a>In a perfect detection routine split and merged positives should be 0 while proportional overlap should be 1. We can shift the start of sound events a bit to reflect a detection in which there is some mismatch to the reference table regarding to the time location of sound events:</span>
<span id="cb51-253"><a href="#cb51-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-254"><a href="#cb51-254" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, }</span></span>
<span id="cb51-255"><a href="#cb51-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-256"><a href="#cb51-256" aria-hidden="true" tabindex="-1"></a><span class="co"># create new table</span></span>
<span id="cb51-257"><a href="#cb51-257" aria-hidden="true" tabindex="-1"></a>lbh1_detection <span class="ot">&lt;-</span> lbh1_reference</span>
<span id="cb51-258"><a href="#cb51-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-259"><a href="#cb51-259" aria-hidden="true" tabindex="-1"></a><span class="co"># add 'noise' to start</span></span>
<span id="cb51-260"><a href="#cb51-260" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">18</span>)</span>
<span id="cb51-261"><a href="#cb51-261" aria-hidden="true" tabindex="-1"></a>lbh1_detection<span class="sc">$</span>start <span class="ot">&lt;-</span></span>
<span id="cb51-262"><a href="#cb51-262" aria-hidden="true" tabindex="-1"></a>  lbh1_detection<span class="sc">$</span>start <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(lbh1_detection), </span>
<span id="cb51-263"><a href="#cb51-263" aria-hidden="true" tabindex="-1"></a>                               <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.1</span>)</span>
<span id="cb51-264"><a href="#cb51-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-265"><a href="#cb51-265" aria-hidden="true" tabindex="-1"></a><span class="do">## print spectrogram</span></span>
<span id="cb51-266"><a href="#cb51-266" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(</span>
<span id="cb51-267"><a href="#cb51-267" aria-hidden="true" tabindex="-1"></a>  <span class="at">wave =</span> lbh1,</span>
<span id="cb51-268"><a href="#cb51-268" aria-hidden="true" tabindex="-1"></a>  <span class="at">reference =</span> lbh1_reference,</span>
<span id="cb51-269"><a href="#cb51-269" aria-hidden="true" tabindex="-1"></a>  <span class="at">detection =</span> lbh1_detection,</span>
<span id="cb51-270"><a href="#cb51-270" aria-hidden="true" tabindex="-1"></a>  <span class="at">hop.size =</span> <span class="dv">10</span>,</span>
<span id="cb51-271"><a href="#cb51-271" aria-hidden="true" tabindex="-1"></a>  <span class="at">ovlp =</span> <span class="dv">50</span>,</span>
<span id="cb51-272"><a href="#cb51-272" aria-hidden="true" tabindex="-1"></a>  <span class="at">flim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb51-273"><a href="#cb51-273" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-274"><a href="#cb51-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-275"><a href="#cb51-275" aria-hidden="true" tabindex="-1"></a><span class="co"># diagnose</span></span>
<span id="cb51-276"><a href="#cb51-276" aria-hidden="true" tabindex="-1"></a><span class="fu">diagnose_detection</span>(<span class="at">reference =</span> lbh1_reference, </span>
<span id="cb51-277"><a href="#cb51-277" aria-hidden="true" tabindex="-1"></a>                   <span class="at">detection =</span> lbh1_detection)</span>
<span id="cb51-278"><a href="#cb51-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-279"><a href="#cb51-279" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-280"><a href="#cb51-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-281"><a href="#cb51-281" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-282"><a href="#cb51-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-283"><a href="#cb51-283" aria-hidden="true" tabindex="-1"></a>In addition, the following diagnostics related to the duration of the sound events can also be returned by setting <span class="in">`time.diagnostics = TRUE`</span>. Here we tweak the reference and detection data just to have some false positives and false negatives:</span>
<span id="cb51-284"><a href="#cb51-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-287"><a href="#cb51-287" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-288"><a href="#cb51-288" aria-hidden="true" tabindex="-1"></a><span class="co"># diagnose with time diagnostics</span></span>
<span id="cb51-289"><a href="#cb51-289" aria-hidden="true" tabindex="-1"></a><span class="fu">diagnose_detection</span>(<span class="at">reference =</span> lbh1_reference[<span class="sc">-</span><span class="dv">1</span>, ], <span class="at">detection =</span> lbh1_detection[<span class="sc">-</span><span class="dv">10</span>, ], <span class="at">time.diagnostics =</span> <span class="cn">TRUE</span>)</span>
<span id="cb51-290"><a href="#cb51-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-291"><a href="#cb51-291" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-292"><a href="#cb51-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-293"><a href="#cb51-293" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-294"><a href="#cb51-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-295"><a href="#cb51-295" aria-hidden="true" tabindex="-1"></a>These additional metrics can be used to further filter out undesired sound events based on their duration (for instance in a energy-based detection as in <span class="in">`energy_detector()`</span>, explained below).</span>
<span id="cb51-296"><a href="#cb51-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-297"><a href="#cb51-297" aria-hidden="true" tabindex="-1"></a>Diagnostics can also be detailed by sound file:</span>
<span id="cb51-298"><a href="#cb51-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-301"><a href="#cb51-301" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-302"><a href="#cb51-302" aria-hidden="true" tabindex="-1"></a><span class="co"># diagnose by sound file</span></span>
<span id="cb51-303"><a href="#cb51-303" aria-hidden="true" tabindex="-1"></a>diagnostic <span class="ot">&lt;-</span></span>
<span id="cb51-304"><a href="#cb51-304" aria-hidden="true" tabindex="-1"></a>  <span class="fu">diagnose_detection</span>(<span class="at">reference =</span> lbh1_reference,</span>
<span id="cb51-305"><a href="#cb51-305" aria-hidden="true" tabindex="-1"></a>                     <span class="at">detection =</span> lbh1_detection,</span>
<span id="cb51-306"><a href="#cb51-306" aria-hidden="true" tabindex="-1"></a>                     <span class="at">by.sound.file =</span> <span class="cn">TRUE</span>)</span>
<span id="cb51-307"><a href="#cb51-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-308"><a href="#cb51-308" aria-hidden="true" tabindex="-1"></a>diagnostic</span>
<span id="cb51-309"><a href="#cb51-309" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-310"><a href="#cb51-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-311"><a href="#cb51-311" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-312"><a href="#cb51-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-313"><a href="#cb51-313" aria-hidden="true" tabindex="-1"></a>These diagnostics can be summarized (as in the default <span class="in">`diagnose_detection()`</span> output) with the function <span class="in">`summarize_diagnostic()`</span>:</span>
<span id="cb51-314"><a href="#cb51-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-317"><a href="#cb51-317" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-318"><a href="#cb51-318" aria-hidden="true" tabindex="-1"></a><span class="co"># summarize</span></span>
<span id="cb51-319"><a href="#cb51-319" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize_diagnostic</span>(diagnostic)</span>
<span id="cb51-320"><a href="#cb51-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-321"><a href="#cb51-321" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-322"><a href="#cb51-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-323"><a href="#cb51-323" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-324"><a href="#cb51-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-325"><a href="#cb51-325" aria-hidden="true" tabindex="-1"></a><span class="fu"># Detecting sound events with *ohun*</span></span>
<span id="cb51-326"><a href="#cb51-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-327"><a href="#cb51-327" aria-hidden="true" tabindex="-1"></a><span class="fu">## Energy-based detection</span></span>
<span id="cb51-328"><a href="#cb51-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-329"><a href="#cb51-329" aria-hidden="true" tabindex="-1"></a>This detector uses amplitude envelopes to infer the position of sound events. Amplitude envelopes are representations of the variation in energy through time. The following code plots an amplitude envelope along with the spectrogram for the example data <span class="in">`lbh1`</span>:</span>
<span id="cb51-330"><a href="#cb51-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-331"><a href="#cb51-331" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, }</span></span>
<span id="cb51-332"><a href="#cb51-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-333"><a href="#cb51-333" aria-hidden="true" tabindex="-1"></a><span class="co"># plot spectrogram and envelope</span></span>
<span id="cb51-334"><a href="#cb51-334" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(</span>
<span id="cb51-335"><a href="#cb51-335" aria-hidden="true" tabindex="-1"></a>  <span class="at">wave =</span> <span class="fu">cutw</span>(</span>
<span id="cb51-336"><a href="#cb51-336" aria-hidden="true" tabindex="-1"></a>    lbh1,</span>
<span id="cb51-337"><a href="#cb51-337" aria-hidden="true" tabindex="-1"></a>    <span class="at">from =</span> <span class="dv">0</span>,</span>
<span id="cb51-338"><a href="#cb51-338" aria-hidden="true" tabindex="-1"></a>    <span class="at">to =</span> <span class="fl">1.5</span>,</span>
<span id="cb51-339"><a href="#cb51-339" aria-hidden="true" tabindex="-1"></a>    <span class="at">output =</span> <span class="st">"Wave"</span></span>
<span id="cb51-340"><a href="#cb51-340" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb51-341"><a href="#cb51-341" aria-hidden="true" tabindex="-1"></a>  <span class="at">ovlp =</span> <span class="dv">90</span>,</span>
<span id="cb51-342"><a href="#cb51-342" aria-hidden="true" tabindex="-1"></a>  <span class="at">hop.size =</span> <span class="dv">10</span>,</span>
<span id="cb51-343"><a href="#cb51-343" aria-hidden="true" tabindex="-1"></a>  <span class="at">flim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb51-344"><a href="#cb51-344" aria-hidden="true" tabindex="-1"></a>  <span class="at">envelope =</span> <span class="cn">TRUE</span></span>
<span id="cb51-345"><a href="#cb51-345" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-346"><a href="#cb51-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-347"><a href="#cb51-347" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-348"><a href="#cb51-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-349"><a href="#cb51-349" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-350"><a href="#cb51-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-351"><a href="#cb51-351" aria-hidden="true" tabindex="-1"></a>This type of detector doesn't require highly stereotyped sound events, although they work better on high quality recordings in which the amplitude of target sound events is higher than the background noise (i.e. high signal-to-noise ratio). The function <span class="in">`energy_detector()`</span> performs this type of detection.</span>
<span id="cb51-352"><a href="#cb51-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-353"><a href="#cb51-353" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-354"><a href="#cb51-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-355"><a href="#cb51-355" aria-hidden="true" tabindex="-1"></a><span class="fu">### How it works</span></span>
<span id="cb51-356"><a href="#cb51-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-357"><a href="#cb51-357" aria-hidden="true" tabindex="-1"></a>We can understand how to use <span class="in">`energy_detector()`</span> using simulated sound events. We will do that using the function <span class="in">`simulate_songs()`</span> from <span class="co">[</span><span class="ot">warbleR</span><span class="co">](https://CRAN.R-project.org/package=warbleR)</span>. In this example we simulate a recording with 10 sounds with two different frequency ranges and durations:</span>
<span id="cb51-358"><a href="#cb51-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-361"><a href="#cb51-361" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-362"><a href="#cb51-362" aria-hidden="true" tabindex="-1"></a><span class="co"># install this package first if not installed</span></span>
<span id="cb51-363"><a href="#cb51-363" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("Sim.DiffProc")</span></span>
<span id="cb51-364"><a href="#cb51-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-365"><a href="#cb51-365" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating vector for duration </span></span>
<span id="cb51-366"><a href="#cb51-366" aria-hidden="true" tabindex="-1"></a>durs <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="fl">0.3</span>, <span class="dv">1</span>), <span class="dv">5</span>)</span>
<span id="cb51-367"><a href="#cb51-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-368"><a href="#cb51-368" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating simulated song</span></span>
<span id="cb51-369"><a href="#cb51-369" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12</span>)</span>
<span id="cb51-370"><a href="#cb51-370" aria-hidden="true" tabindex="-1"></a>simulated_1 <span class="ot">&lt;-</span></span>
<span id="cb51-371"><a href="#cb51-371" aria-hidden="true" tabindex="-1"></a>  warbleR<span class="sc">::</span><span class="fu">simulate_songs</span>(</span>
<span id="cb51-372"><a href="#cb51-372" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="dv">10</span>,</span>
<span id="cb51-373"><a href="#cb51-373" aria-hidden="true" tabindex="-1"></a>    <span class="at">durs =</span> durs,</span>
<span id="cb51-374"><a href="#cb51-374" aria-hidden="true" tabindex="-1"></a>    <span class="at">freqs =</span> <span class="dv">5</span>,</span>
<span id="cb51-375"><a href="#cb51-375" aria-hidden="true" tabindex="-1"></a>    <span class="at">sig2 =</span> <span class="fl">0.01</span>,</span>
<span id="cb51-376"><a href="#cb51-376" aria-hidden="true" tabindex="-1"></a>    <span class="at">gaps =</span> <span class="fl">0.5</span>,</span>
<span id="cb51-377"><a href="#cb51-377" aria-hidden="true" tabindex="-1"></a>    <span class="at">harms =</span> <span class="dv">1</span>,</span>
<span id="cb51-378"><a href="#cb51-378" aria-hidden="true" tabindex="-1"></a>    <span class="at">bgn =</span> <span class="fl">0.1</span>,</span>
<span id="cb51-379"><a href="#cb51-379" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="fu">tempdir</span>(),</span>
<span id="cb51-380"><a href="#cb51-380" aria-hidden="true" tabindex="-1"></a>    <span class="at">file.name =</span> <span class="st">"simulated_1"</span>,</span>
<span id="cb51-381"><a href="#cb51-381" aria-hidden="true" tabindex="-1"></a>    <span class="at">selec.table =</span> <span class="cn">TRUE</span>,</span>
<span id="cb51-382"><a href="#cb51-382" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="st">"cos"</span>,</span>
<span id="cb51-383"><a href="#cb51-383" aria-hidden="true" tabindex="-1"></a>    <span class="at">fin =</span> <span class="fl">0.3</span>,</span>
<span id="cb51-384"><a href="#cb51-384" aria-hidden="true" tabindex="-1"></a>    <span class="at">fout =</span> <span class="fl">0.35</span>,</span>
<span id="cb51-385"><a href="#cb51-385" aria-hidden="true" tabindex="-1"></a>    <span class="at">samp.rate =</span> <span class="dv">18</span></span>
<span id="cb51-386"><a href="#cb51-386" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">$</span>wave</span>
<span id="cb51-387"><a href="#cb51-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-388"><a href="#cb51-388" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-389"><a href="#cb51-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-390"><a href="#cb51-390" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-391"><a href="#cb51-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-392"><a href="#cb51-392" aria-hidden="true" tabindex="-1"></a>The function call saves a '.wav' sound file in a temporary directory (<span class="in">`tempdir()`</span>) and also returns a <span class="in">`wave`</span> object in the R environment. This outputs will be used to run energy-based detection and creating plots, respectively. This is how the spectrogram and amplitude envelope of the simulated recording look like:</span>
<span id="cb51-393"><a href="#cb51-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-394"><a href="#cb51-394" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=4, fig.width=10}</span></span>
<span id="cb51-395"><a href="#cb51-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-396"><a href="#cb51-396" aria-hidden="true" tabindex="-1"></a><span class="co"># plot spectrogram and envelope</span></span>
<span id="cb51-397"><a href="#cb51-397" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(<span class="at">wave =</span> simulated_1,</span>
<span id="cb51-398"><a href="#cb51-398" aria-hidden="true" tabindex="-1"></a>              <span class="at">env =</span> <span class="cn">TRUE</span>,</span>
<span id="cb51-399"><a href="#cb51-399" aria-hidden="true" tabindex="-1"></a>              <span class="at">fastdisp =</span> <span class="cn">TRUE</span>)</span>
<span id="cb51-400"><a href="#cb51-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-401"><a href="#cb51-401" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-402"><a href="#cb51-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-403"><a href="#cb51-403" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-404"><a href="#cb51-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-405"><a href="#cb51-405" aria-hidden="true" tabindex="-1"></a>Note that the amplitude envelope shows a high signal-to-noise ratio of the sound events, which is ideal for energy-based detection. This can be conducted using <span class="in">`energy_detector()`</span> as follows:</span>
<span id="cb51-406"><a href="#cb51-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-407"><a href="#cb51-407" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=4, fig.width=10}</span></span>
<span id="cb51-408"><a href="#cb51-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-409"><a href="#cb51-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-410"><a href="#cb51-410" aria-hidden="true" tabindex="-1"></a><span class="co"># run detection</span></span>
<span id="cb51-411"><a href="#cb51-411" aria-hidden="true" tabindex="-1"></a>detection <span class="ot">&lt;-</span></span>
<span id="cb51-412"><a href="#cb51-412" aria-hidden="true" tabindex="-1"></a><span class="fu">energy_detector</span>(</span>
<span id="cb51-413"><a href="#cb51-413" aria-hidden="true" tabindex="-1"></a>  <span class="at">files =</span> <span class="st">"simulated_1.wav"</span>,</span>
<span id="cb51-414"><a href="#cb51-414" aria-hidden="true" tabindex="-1"></a>  <span class="at">bp =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">8</span>),</span>
<span id="cb51-415"><a href="#cb51-415" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> <span class="dv">50</span>,</span>
<span id="cb51-416"><a href="#cb51-416" aria-hidden="true" tabindex="-1"></a>  <span class="at">smooth =</span> <span class="dv">150</span>,</span>
<span id="cb51-417"><a href="#cb51-417" aria-hidden="true" tabindex="-1"></a>  <span class="at">path =</span> <span class="fu">tempdir</span>()</span>
<span id="cb51-418"><a href="#cb51-418" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-419"><a href="#cb51-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-420"><a href="#cb51-420" aria-hidden="true" tabindex="-1"></a><span class="co"># plot spectrogram and envelope</span></span>
<span id="cb51-421"><a href="#cb51-421" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(</span>
<span id="cb51-422"><a href="#cb51-422" aria-hidden="true" tabindex="-1"></a><span class="at">wave =</span> simulated_1,</span>
<span id="cb51-423"><a href="#cb51-423" aria-hidden="true" tabindex="-1"></a><span class="at">envelope =</span> <span class="cn">TRUE</span>,</span>
<span id="cb51-424"><a href="#cb51-424" aria-hidden="true" tabindex="-1"></a><span class="at">detection =</span> detection,</span>
<span id="cb51-425"><a href="#cb51-425" aria-hidden="true" tabindex="-1"></a><span class="at">threshold =</span> <span class="dv">50</span></span>
<span id="cb51-426"><a href="#cb51-426" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-427"><a href="#cb51-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-428"><a href="#cb51-428" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-429"><a href="#cb51-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-430"><a href="#cb51-430" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-431"><a href="#cb51-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-432"><a href="#cb51-432" aria-hidden="true" tabindex="-1"></a>The output is a selection table:</span>
<span id="cb51-433"><a href="#cb51-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-436"><a href="#cb51-436" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-437"><a href="#cb51-437" aria-hidden="true" tabindex="-1"></a>detection</span>
<span id="cb51-438"><a href="#cb51-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-439"><a href="#cb51-439" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-440"><a href="#cb51-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-441"><a href="#cb51-441" aria-hidden="true" tabindex="-1"></a>Now we will make use of some additional arguments to filter out specific sound events based on their structural features. For instance we can use the argument <span class="in">`min.duration`</span> to provide a time treshold (in ms) to exclude short sound events and keep only the longest sound events:</span>
<span id="cb51-442"><a href="#cb51-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-443"><a href="#cb51-443" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = TRUE, echo = TRUE, fig.height=4, fig.width=10}</span></span>
<span id="cb51-444"><a href="#cb51-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-445"><a href="#cb51-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-446"><a href="#cb51-446" aria-hidden="true" tabindex="-1"></a><span class="co"># run detection</span></span>
<span id="cb51-447"><a href="#cb51-447" aria-hidden="true" tabindex="-1"></a>detection <span class="ot">&lt;-</span></span>
<span id="cb51-448"><a href="#cb51-448" aria-hidden="true" tabindex="-1"></a>  <span class="fu">energy_detector</span>(</span>
<span id="cb51-449"><a href="#cb51-449" aria-hidden="true" tabindex="-1"></a>    <span class="at">files =</span> <span class="st">"simulated_1.wav"</span>,</span>
<span id="cb51-450"><a href="#cb51-450" aria-hidden="true" tabindex="-1"></a>    <span class="at">bp =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">8</span>),</span>
<span id="cb51-451"><a href="#cb51-451" aria-hidden="true" tabindex="-1"></a>    <span class="at">threshold =</span> <span class="dv">50</span>,</span>
<span id="cb51-452"><a href="#cb51-452" aria-hidden="true" tabindex="-1"></a>    <span class="at">min.duration =</span> <span class="dv">500</span>,</span>
<span id="cb51-453"><a href="#cb51-453" aria-hidden="true" tabindex="-1"></a>    <span class="at">smooth =</span> <span class="dv">150</span>,</span>
<span id="cb51-454"><a href="#cb51-454" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="fu">tempdir</span>()</span>
<span id="cb51-455"><a href="#cb51-455" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb51-456"><a href="#cb51-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-457"><a href="#cb51-457" aria-hidden="true" tabindex="-1"></a><span class="co"># plot spectrogram</span></span>
<span id="cb51-458"><a href="#cb51-458" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(<span class="at">wave =</span> simulated_1, <span class="at">detection =</span> detection)</span>
<span id="cb51-459"><a href="#cb51-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-460"><a href="#cb51-460" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-461"><a href="#cb51-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-462"><a href="#cb51-462" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-463"><a href="#cb51-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-464"><a href="#cb51-464" aria-hidden="true" tabindex="-1"></a>We can use the argument <span class="in">`max.duration`</span> (also in ms) to exclude long sound events and keep the short ones:</span>
<span id="cb51-465"><a href="#cb51-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-466"><a href="#cb51-466" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = TRUE, echo = TRUE, fig.height=4, fig.width=10}</span></span>
<span id="cb51-467"><a href="#cb51-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-468"><a href="#cb51-468" aria-hidden="true" tabindex="-1"></a><span class="co"># run detection</span></span>
<span id="cb51-469"><a href="#cb51-469" aria-hidden="true" tabindex="-1"></a>detection <span class="ot">&lt;-</span></span>
<span id="cb51-470"><a href="#cb51-470" aria-hidden="true" tabindex="-1"></a>  <span class="fu">energy_detector</span>(</span>
<span id="cb51-471"><a href="#cb51-471" aria-hidden="true" tabindex="-1"></a>    <span class="at">files =</span> <span class="st">"simulated_1.wav"</span>,</span>
<span id="cb51-472"><a href="#cb51-472" aria-hidden="true" tabindex="-1"></a>    <span class="at">bp =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">8</span>),</span>
<span id="cb51-473"><a href="#cb51-473" aria-hidden="true" tabindex="-1"></a>    <span class="at">threshold =</span> <span class="dv">50</span>,</span>
<span id="cb51-474"><a href="#cb51-474" aria-hidden="true" tabindex="-1"></a>    <span class="at">smooth =</span> <span class="dv">150</span>,</span>
<span id="cb51-475"><a href="#cb51-475" aria-hidden="true" tabindex="-1"></a>    <span class="at">max.duration =</span> <span class="dv">500</span>,</span>
<span id="cb51-476"><a href="#cb51-476" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="fu">tempdir</span>()</span>
<span id="cb51-477"><a href="#cb51-477" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb51-478"><a href="#cb51-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-479"><a href="#cb51-479" aria-hidden="true" tabindex="-1"></a><span class="co"># plot spectrogram</span></span>
<span id="cb51-480"><a href="#cb51-480" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(<span class="at">wave =</span> simulated_1,  <span class="at">detection =</span> detection)</span>
<span id="cb51-481"><a href="#cb51-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-482"><a href="#cb51-482" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-483"><a href="#cb51-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-484"><a href="#cb51-484" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-485"><a href="#cb51-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-486"><a href="#cb51-486" aria-hidden="true" tabindex="-1"></a>We can also focus the detection on specific frequency ranges using the argument <span class="in">`bp`</span> (bandpass). By setting <span class="in">`bp = c(5, 8)`</span> only those sound events found within that frequency range (5-8 kHz) will be detected, which excludes sound events below 5 kHz:</span>
<span id="cb51-487"><a href="#cb51-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-488"><a href="#cb51-488" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=4, fig.width=10, eval = TRUE, echo = TRUE}</span></span>
<span id="cb51-489"><a href="#cb51-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-490"><a href="#cb51-490" aria-hidden="true" tabindex="-1"></a><span class="co"># Detecting</span></span>
<span id="cb51-491"><a href="#cb51-491" aria-hidden="true" tabindex="-1"></a>detection <span class="ot">&lt;-</span></span>
<span id="cb51-492"><a href="#cb51-492" aria-hidden="true" tabindex="-1"></a>  <span class="fu">energy_detector</span>(</span>
<span id="cb51-493"><a href="#cb51-493" aria-hidden="true" tabindex="-1"></a>    <span class="at">files =</span> <span class="st">"simulated_1.wav"</span>,</span>
<span id="cb51-494"><a href="#cb51-494" aria-hidden="true" tabindex="-1"></a>    <span class="at">bp =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">8</span>),</span>
<span id="cb51-495"><a href="#cb51-495" aria-hidden="true" tabindex="-1"></a>    <span class="at">threshold =</span> <span class="dv">50</span>,</span>
<span id="cb51-496"><a href="#cb51-496" aria-hidden="true" tabindex="-1"></a>    <span class="at">smooth =</span> <span class="dv">150</span>,</span>
<span id="cb51-497"><a href="#cb51-497" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="fu">tempdir</span>()</span>
<span id="cb51-498"><a href="#cb51-498" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb51-499"><a href="#cb51-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-500"><a href="#cb51-500" aria-hidden="true" tabindex="-1"></a><span class="co"># plot spectrogram</span></span>
<span id="cb51-501"><a href="#cb51-501" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(<span class="at">wave =</span> simulated_1,  <span class="at">detection =</span> detection)</span>
<span id="cb51-502"><a href="#cb51-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-503"><a href="#cb51-503" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-504"><a href="#cb51-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-505"><a href="#cb51-505" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-506"><a href="#cb51-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-507"><a href="#cb51-507" aria-hidden="true" tabindex="-1"></a>::: {.alert .alert-info}</span>
<span id="cb51-508"><a href="#cb51-508" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;font</span> <span class="er">size</span><span class="ot">=</span><span class="st">"5"</span><span class="kw">&gt;</span>Exercise<span class="kw">&lt;/font&gt;</span></span>
<span id="cb51-509"><a href="#cb51-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-510"><a href="#cb51-510" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Detect only the short sound below 5 kHz</span>
<span id="cb51-511"><a href="#cb51-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-512"><a href="#cb51-512" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=4, fig.width=10, eval = FALSE, echo = FALSE}</span></span>
<span id="cb51-513"><a href="#cb51-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-514"><a href="#cb51-514" aria-hidden="true" tabindex="-1"></a><span class="co"># Detect</span></span>
<span id="cb51-515"><a href="#cb51-515" aria-hidden="true" tabindex="-1"></a>detection <span class="ot">&lt;-</span></span>
<span id="cb51-516"><a href="#cb51-516" aria-hidden="true" tabindex="-1"></a>  <span class="fu">energy_detector</span>(</span>
<span id="cb51-517"><a href="#cb51-517" aria-hidden="true" tabindex="-1"></a>    <span class="at">files =</span> <span class="st">"simulated_1.wav"</span>,</span>
<span id="cb51-518"><a href="#cb51-518" aria-hidden="true" tabindex="-1"></a>    <span class="at">bp =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>),</span>
<span id="cb51-519"><a href="#cb51-519" aria-hidden="true" tabindex="-1"></a>    <span class="at">threshold =</span> <span class="dv">50</span>,</span>
<span id="cb51-520"><a href="#cb51-520" aria-hidden="true" tabindex="-1"></a>    <span class="at">max.duration =</span> <span class="dv">500</span>,</span>
<span id="cb51-521"><a href="#cb51-521" aria-hidden="true" tabindex="-1"></a>    <span class="at">smooth =</span> <span class="dv">150</span>,</span>
<span id="cb51-522"><a href="#cb51-522" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="fu">tempdir</span>()</span>
<span id="cb51-523"><a href="#cb51-523" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb51-524"><a href="#cb51-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-525"><a href="#cb51-525" aria-hidden="true" tabindex="-1"></a><span class="co"># plot spectrogram</span></span>
<span id="cb51-526"><a href="#cb51-526" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(<span class="at">wave =</span> simulated_1,  <span class="at">detection =</span> detection)</span>
<span id="cb51-527"><a href="#cb51-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-528"><a href="#cb51-528" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-529"><a href="#cb51-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-530"><a href="#cb51-530" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb51-531"><a href="#cb51-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-532"><a href="#cb51-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-533"><a href="#cb51-533" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-534"><a href="#cb51-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-535"><a href="#cb51-535" aria-hidden="true" tabindex="-1"></a>Amplitude modulation (variation in amplitude across a sound event) can be problematic for detection based on amplitude envelopes. We can also simulate some amplitude modulation using <span class="in">`warbleR::simulate_songs()`</span>:</span>
<span id="cb51-536"><a href="#cb51-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-537"><a href="#cb51-537" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = TRUE, warning=FALSE, message=FALSE}</span></span>
<span id="cb51-538"><a href="#cb51-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-539"><a href="#cb51-539" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating simulated song</span></span>
<span id="cb51-540"><a href="#cb51-540" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12</span>)</span>
<span id="cb51-541"><a href="#cb51-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-542"><a href="#cb51-542" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating vector for duration</span></span>
<span id="cb51-543"><a href="#cb51-543" aria-hidden="true" tabindex="-1"></a>durs <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="fl">0.3</span>, <span class="dv">1</span>), <span class="dv">5</span>)</span>
<span id="cb51-544"><a href="#cb51-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-545"><a href="#cb51-545" aria-hidden="true" tabindex="-1"></a>sim_2 <span class="ot">&lt;-</span></span>
<span id="cb51-546"><a href="#cb51-546" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sim_songs</span>(</span>
<span id="cb51-547"><a href="#cb51-547" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="dv">10</span>,</span>
<span id="cb51-548"><a href="#cb51-548" aria-hidden="true" tabindex="-1"></a>    <span class="at">durs =</span> durs,</span>
<span id="cb51-549"><a href="#cb51-549" aria-hidden="true" tabindex="-1"></a>    <span class="at">freqs =</span> <span class="dv">5</span>,</span>
<span id="cb51-550"><a href="#cb51-550" aria-hidden="true" tabindex="-1"></a>    <span class="at">sig2 =</span> <span class="fl">0.01</span>,</span>
<span id="cb51-551"><a href="#cb51-551" aria-hidden="true" tabindex="-1"></a>    <span class="at">gaps =</span> <span class="fl">0.5</span>,</span>
<span id="cb51-552"><a href="#cb51-552" aria-hidden="true" tabindex="-1"></a>    <span class="at">harms =</span> <span class="dv">1</span>,</span>
<span id="cb51-553"><a href="#cb51-553" aria-hidden="true" tabindex="-1"></a>    <span class="at">bgn =</span> <span class="fl">0.1</span>,</span>
<span id="cb51-554"><a href="#cb51-554" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="fu">tempdir</span>(),</span>
<span id="cb51-555"><a href="#cb51-555" aria-hidden="true" tabindex="-1"></a>    <span class="at">file.name =</span> <span class="st">"simulated_2"</span>,</span>
<span id="cb51-556"><a href="#cb51-556" aria-hidden="true" tabindex="-1"></a>    <span class="at">selec.table =</span> <span class="cn">TRUE</span>,</span>
<span id="cb51-557"><a href="#cb51-557" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="st">"cos"</span>,</span>
<span id="cb51-558"><a href="#cb51-558" aria-hidden="true" tabindex="-1"></a>    <span class="at">fin =</span> <span class="fl">0.3</span>,</span>
<span id="cb51-559"><a href="#cb51-559" aria-hidden="true" tabindex="-1"></a>    <span class="at">fout =</span> <span class="fl">0.35</span>,</span>
<span id="cb51-560"><a href="#cb51-560" aria-hidden="true" tabindex="-1"></a>    <span class="at">samp.rate =</span> <span class="dv">18</span>,</span>
<span id="cb51-561"><a href="#cb51-561" aria-hidden="true" tabindex="-1"></a>    <span class="at">am.amps =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="fl">0.1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb51-562"><a href="#cb51-562" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb51-563"><a href="#cb51-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-564"><a href="#cb51-564" aria-hidden="true" tabindex="-1"></a><span class="co"># extract wave object and selection table</span></span>
<span id="cb51-565"><a href="#cb51-565" aria-hidden="true" tabindex="-1"></a>simulated_2 <span class="ot">&lt;-</span> sim_2<span class="sc">$</span>wave</span>
<span id="cb51-566"><a href="#cb51-566" aria-hidden="true" tabindex="-1"></a>sim2_sel_table <span class="ot">&lt;-</span> sim_2<span class="sc">$</span>selec.table</span>
<span id="cb51-567"><a href="#cb51-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-568"><a href="#cb51-568" aria-hidden="true" tabindex="-1"></a><span class="co"># plot spectrogram</span></span>
<span id="cb51-569"><a href="#cb51-569" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(<span class="at">wave =</span> simulated_2, <span class="at">envelope =</span> <span class="cn">TRUE</span>)</span>
<span id="cb51-570"><a href="#cb51-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-571"><a href="#cb51-571" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-572"><a href="#cb51-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-573"><a href="#cb51-573" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-574"><a href="#cb51-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-575"><a href="#cb51-575" aria-hidden="true" tabindex="-1"></a>When sound events have strong amplitude modulation they can be split during detection:</span>
<span id="cb51-576"><a href="#cb51-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-577"><a href="#cb51-577" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = TRUE}</span></span>
<span id="cb51-578"><a href="#cb51-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-579"><a href="#cb51-579" aria-hidden="true" tabindex="-1"></a><span class="co"># detect sounds</span></span>
<span id="cb51-580"><a href="#cb51-580" aria-hidden="true" tabindex="-1"></a>detection <span class="ot">&lt;-</span> <span class="fu">energy_detector</span>(<span class="at">files =</span> <span class="st">"simulated_2.wav"</span>, <span class="at">threshold =</span> <span class="dv">50</span>, <span class="at">path =</span> <span class="fu">tempdir</span>())</span>
<span id="cb51-581"><a href="#cb51-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-582"><a href="#cb51-582" aria-hidden="true" tabindex="-1"></a><span class="co"># plot spectrogram</span></span>
<span id="cb51-583"><a href="#cb51-583" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(<span class="at">wave =</span> simulated_2, <span class="at">envelope =</span> <span class="cn">TRUE</span>, <span class="at">threshold =</span> <span class="dv">50</span>, <span class="at">detection =</span> detection)</span>
<span id="cb51-584"><a href="#cb51-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-585"><a href="#cb51-585" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-586"><a href="#cb51-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-587"><a href="#cb51-587" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-588"><a href="#cb51-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-589"><a href="#cb51-589" aria-hidden="true" tabindex="-1"></a>There are two arguments that can deal with this: <span class="in">`holdtime`</span> and <span class="in">`smooth`</span>. <span class="in">`hold.time`</span> allows to merge split sound events that are found within a given time range (in ms). This time range should be high enough to merge things belonging to the same sound event but not too high so it merges different sound events. For this example a <span class="in">`hold.time`</span> of 200 ms can do the trick (we know gaps between sound events are \~0.5 s long):</span>
<span id="cb51-590"><a href="#cb51-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-591"><a href="#cb51-591" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = TRUE}</span></span>
<span id="cb51-592"><a href="#cb51-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-593"><a href="#cb51-593" aria-hidden="true" tabindex="-1"></a><span class="co"># detect sounds</span></span>
<span id="cb51-594"><a href="#cb51-594" aria-hidden="true" tabindex="-1"></a>detection <span class="ot">&lt;-</span></span>
<span id="cb51-595"><a href="#cb51-595" aria-hidden="true" tabindex="-1"></a>  <span class="fu">energy_detector</span>(</span>
<span id="cb51-596"><a href="#cb51-596" aria-hidden="true" tabindex="-1"></a>    <span class="at">files =</span> <span class="st">"simulated_2.wav"</span>,</span>
<span id="cb51-597"><a href="#cb51-597" aria-hidden="true" tabindex="-1"></a>    <span class="at">threshold =</span> <span class="dv">50</span>,</span>
<span id="cb51-598"><a href="#cb51-598" aria-hidden="true" tabindex="-1"></a>    <span class="at">min.duration =</span> <span class="dv">1</span>,</span>
<span id="cb51-599"><a href="#cb51-599" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="fu">tempdir</span>(),</span>
<span id="cb51-600"><a href="#cb51-600" aria-hidden="true" tabindex="-1"></a>    <span class="at">hold.time =</span> <span class="dv">200</span></span>
<span id="cb51-601"><a href="#cb51-601" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb51-602"><a href="#cb51-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-603"><a href="#cb51-603" aria-hidden="true" tabindex="-1"></a><span class="co"># plot spectrogram</span></span>
<span id="cb51-604"><a href="#cb51-604" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(</span>
<span id="cb51-605"><a href="#cb51-605" aria-hidden="true" tabindex="-1"></a>  <span class="at">wave =</span> simulated_2,</span>
<span id="cb51-606"><a href="#cb51-606" aria-hidden="true" tabindex="-1"></a>  <span class="at">envelope =</span> <span class="cn">TRUE</span>,</span>
<span id="cb51-607"><a href="#cb51-607" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> <span class="dv">50</span>,</span>
<span id="cb51-608"><a href="#cb51-608" aria-hidden="true" tabindex="-1"></a>  <span class="at">detection =</span> detection</span>
<span id="cb51-609"><a href="#cb51-609" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-610"><a href="#cb51-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-611"><a href="#cb51-611" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-612"><a href="#cb51-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-613"><a href="#cb51-613" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-614"><a href="#cb51-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-615"><a href="#cb51-615" aria-hidden="true" tabindex="-1"></a><span class="in">`smooth`</span> works by merging the amplitude envelope 'hills' of the split sound events themselves. It smooths envelopes by applying a sliding window averaging of amplitude values. It's given in ms of the window size. A <span class="in">`smooth`</span> of 350 ms can merged back split sound events from our example:</span>
<span id="cb51-616"><a href="#cb51-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-617"><a href="#cb51-617" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = TRUE}</span></span>
<span id="cb51-618"><a href="#cb51-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-619"><a href="#cb51-619" aria-hidden="true" tabindex="-1"></a><span class="co"># detect sounds</span></span>
<span id="cb51-620"><a href="#cb51-620" aria-hidden="true" tabindex="-1"></a>detection <span class="ot">&lt;-</span></span>
<span id="cb51-621"><a href="#cb51-621" aria-hidden="true" tabindex="-1"></a>  <span class="fu">energy_detector</span>(</span>
<span id="cb51-622"><a href="#cb51-622" aria-hidden="true" tabindex="-1"></a>    <span class="at">files =</span> <span class="st">"simulated_2.wav"</span>,</span>
<span id="cb51-623"><a href="#cb51-623" aria-hidden="true" tabindex="-1"></a>    <span class="at">threshold =</span> <span class="dv">50</span>,</span>
<span id="cb51-624"><a href="#cb51-624" aria-hidden="true" tabindex="-1"></a>    <span class="at">min.duration =</span> <span class="dv">1</span>,</span>
<span id="cb51-625"><a href="#cb51-625" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="fu">tempdir</span>(),</span>
<span id="cb51-626"><a href="#cb51-626" aria-hidden="true" tabindex="-1"></a>    <span class="at">smooth =</span> <span class="dv">350</span></span>
<span id="cb51-627"><a href="#cb51-627" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb51-628"><a href="#cb51-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-629"><a href="#cb51-629" aria-hidden="true" tabindex="-1"></a><span class="co"># plot spectrogram</span></span>
<span id="cb51-630"><a href="#cb51-630" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(</span>
<span id="cb51-631"><a href="#cb51-631" aria-hidden="true" tabindex="-1"></a>  <span class="at">wave =</span> simulated_2,</span>
<span id="cb51-632"><a href="#cb51-632" aria-hidden="true" tabindex="-1"></a>  <span class="at">envelope =</span> <span class="cn">TRUE</span>,</span>
<span id="cb51-633"><a href="#cb51-633" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> <span class="dv">50</span>,</span>
<span id="cb51-634"><a href="#cb51-634" aria-hidden="true" tabindex="-1"></a>  <span class="at">detection =</span> detection,</span>
<span id="cb51-635"><a href="#cb51-635" aria-hidden="true" tabindex="-1"></a>  <span class="at">smooth =</span> <span class="dv">350</span></span>
<span id="cb51-636"><a href="#cb51-636" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-637"><a href="#cb51-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-638"><a href="#cb51-638" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-639"><a href="#cb51-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-640"><a href="#cb51-640" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-641"><a href="#cb51-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-642"><a href="#cb51-642" aria-hidden="true" tabindex="-1"></a>The function has some additional arguments for further filtering detections (<span class="in">`peak.amplitude`</span>) and speeding up analysis (<span class="in">`thinning`</span> and <span class="in">`parallel`</span>).</span>
<span id="cb51-643"><a href="#cb51-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-644"><a href="#cb51-644" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-645"><a href="#cb51-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-646"><a href="#cb51-646" aria-hidden="true" tabindex="-1"></a><span class="fu">### Optimizing energy-based detection</span></span>
<span id="cb51-647"><a href="#cb51-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-648"><a href="#cb51-648" aria-hidden="true" tabindex="-1"></a>This last example using <span class="in">`smooth`</span> can be used to showcase how the tunning parameters can be optimized. As explained above, to do this we need a reference table that contains the time position of the target sound events. The function <span class="in">`optimize_energy_detector()`</span> can be used finding the optimal parameter values. We must provide the range of parameter values that will be evaluated:</span>
<span id="cb51-649"><a href="#cb51-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-652"><a href="#cb51-652" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-653"><a href="#cb51-653" aria-hidden="true" tabindex="-1"></a>optim_detection <span class="ot">&lt;-</span></span>
<span id="cb51-654"><a href="#cb51-654" aria-hidden="true" tabindex="-1"></a>  <span class="fu">optimize_energy_detector</span>(</span>
<span id="cb51-655"><a href="#cb51-655" aria-hidden="true" tabindex="-1"></a>    <span class="at">reference =</span> sim2_sel_table,</span>
<span id="cb51-656"><a href="#cb51-656" aria-hidden="true" tabindex="-1"></a>    <span class="at">files =</span> <span class="st">"simulated_2.wav"</span>,</span>
<span id="cb51-657"><a href="#cb51-657" aria-hidden="true" tabindex="-1"></a>    <span class="at">threshold =</span> <span class="dv">50</span>,</span>
<span id="cb51-658"><a href="#cb51-658" aria-hidden="true" tabindex="-1"></a>    <span class="at">min.duration =</span> <span class="dv">1</span>,</span>
<span id="cb51-659"><a href="#cb51-659" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="fu">tempdir</span>(),</span>
<span id="cb51-660"><a href="#cb51-660" aria-hidden="true" tabindex="-1"></a>    <span class="at">smooth =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">250</span>, <span class="dv">350</span>)</span>
<span id="cb51-661"><a href="#cb51-661" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb51-662"><a href="#cb51-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-663"><a href="#cb51-663" aria-hidden="true" tabindex="-1"></a>optim_detection[, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">12</span>, <span class="dv">17</span><span class="sc">:</span><span class="dv">18</span>)]</span>
<span id="cb51-664"><a href="#cb51-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-665"><a href="#cb51-665" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-666"><a href="#cb51-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-667"><a href="#cb51-667" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-668"><a href="#cb51-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-669"><a href="#cb51-669" aria-hidden="true" tabindex="-1"></a>The output contains the combination of parameters used at each iteration as well as the corresponding diagnose indices. In this case all combinations generate a good detection (recall &amp; precision = 1). However, only the routine with the highest <span class="in">`smooth`</span> (last row) has no split sound events ('split.positive' column). It also shows a better overlap to the reference sound events ('overlap.to.true.positives' closer to 1).</span>
<span id="cb51-670"><a href="#cb51-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-671"><a href="#cb51-671" aria-hidden="true" tabindex="-1"></a>In addition, there are two complementary functions for optimizing energy-based detection routines: <span class="in">`feature_reference()`</span> and <span class="in">`merge_overlaps()`</span>. <span class="in">`feature_reference()`</span> allow user to get a sense of the time and frequency characteristics of a reference table. This information can be used to determine the range of tuning parameter values during optimization. This is the output of the function applied to <span class="in">`lbh_reference`</span>:</span>
<span id="cb51-672"><a href="#cb51-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-675"><a href="#cb51-675" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-676"><a href="#cb51-676" aria-hidden="true" tabindex="-1"></a><span class="fu">feature_reference</span>(<span class="at">reference =</span> lbh_reference, <span class="at">path =</span> <span class="fu">tempdir</span>())</span>
<span id="cb51-677"><a href="#cb51-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-678"><a href="#cb51-678" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-679"><a href="#cb51-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-680"><a href="#cb51-680" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-681"><a href="#cb51-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-682"><a href="#cb51-682" aria-hidden="true" tabindex="-1"></a>Features related to selection duration can be used to set the 'max.duration' and 'min.duration' values, frequency related features can inform banpass values, gap related features inform hold time values and duty cycle can be used to evaluate performance. Peak amplitude can be used to keep only those sound events with the highest intensity, mostly useful for routines in which only a subset of the target sound events present in the recordings is needed.</span>
<span id="cb51-683"><a href="#cb51-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-684"><a href="#cb51-684" aria-hidden="true" tabindex="-1"></a><span class="in">`merge_overlaps()`</span> finds time-overlapping selections in reference tables and collapses them into a single selection. Overlapping selections would more likely appear as a single amplitude 'hill' and thus would be detected as a single sound event. So <span class="in">`merge_overlaps()`</span> can be useful to prepare references in a format representing a more realistic expectation of how a pefect energy detection routine would look like.</span>
<span id="cb51-685"><a href="#cb51-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-686"><a href="#cb51-686" aria-hidden="true" tabindex="-1"></a><span class="fu">## Template-based detection</span></span>
<span id="cb51-687"><a href="#cb51-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-688"><a href="#cb51-688" aria-hidden="true" tabindex="-1"></a>This detection method is better suited for highly stereotyped sound events. As it doesn't depend on the signal-to-noise ratio it's more robust to higher levels of background noise. The procedure is divided in three steps:</span>
<span id="cb51-689"><a href="#cb51-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-690"><a href="#cb51-690" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Choosing the right template (<span class="in">`get_templates()`</span>)</span>
<span id="cb51-691"><a href="#cb51-691" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Estimating the cross-correlation scores of templates along sound files (<span class="in">`template_correlator()`</span>)\</span>
<span id="cb51-692"><a href="#cb51-692" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Detecting sound events by applying a correlation threshold (<span class="in">`template_detector()`</span>)</span>
<span id="cb51-693"><a href="#cb51-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-694"><a href="#cb51-694" aria-hidden="true" tabindex="-1"></a>The function <span class="in">`get_templates()`</span> can help you find a template closer to the average acoustic structure of the sound events in a reference table. This is done by finding the sound events closer to the centroid of the acoustic space. When the acoustic space is not supplied ('acoustic.space' argument) the function estimates it by measuring several acoustic parameters using the function <span class="co">[</span><span class="ot">`spectro_analysis()`</span><span class="co">](https://marce10.github.io/warbleR/reference/spectro_analysis.html)</span> from <span class="co">[</span><span class="ot">`warbleR`</span><span class="co">](https://CRAN.R-project.org/package=warbleR)</span>) and summarizing it with Principal Component Analysis (after z-transforming parameters). If only 1 template is required the function returns the sound event closest to the acoustic space centroid. The rationale here is that a sound event closest to the average sound event structure is more likely to share structural features with most sounds across the acoustic space than a sound event in the periphery of the space. These 'mean structure' templates can be obtained as follows:</span>
<span id="cb51-695"><a href="#cb51-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-696"><a href="#cb51-696" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE, echo = TRUE}</span></span>
<span id="cb51-697"><a href="#cb51-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-698"><a href="#cb51-698" aria-hidden="true" tabindex="-1"></a><span class="co"># get mean structure template</span></span>
<span id="cb51-699"><a href="#cb51-699" aria-hidden="true" tabindex="-1"></a>template <span class="ot">&lt;-</span></span>
<span id="cb51-700"><a href="#cb51-700" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_templates</span>(<span class="at">reference =</span> lbh1_reference, <span class="at">path =</span> <span class="fu">tempdir</span>())</span>
<span id="cb51-701"><a href="#cb51-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-702"><a href="#cb51-702" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-703"><a href="#cb51-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-704"><a href="#cb51-704" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=6, fig.height=5, eval = TRUE, echo = FALSE}</span></span>
<span id="cb51-705"><a href="#cb51-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-706"><a href="#cb51-706" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="at">bg =</span> <span class="st">"white"</span>)</span>
<span id="cb51-707"><a href="#cb51-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-708"><a href="#cb51-708" aria-hidden="true" tabindex="-1"></a><span class="co"># get mean structure template</span></span>
<span id="cb51-709"><a href="#cb51-709" aria-hidden="true" tabindex="-1"></a>template <span class="ot">&lt;-</span></span>
<span id="cb51-710"><a href="#cb51-710" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_templates</span>(<span class="at">reference =</span> lbh1_reference, <span class="at">path =</span> <span class="fu">tempdir</span>())</span>
<span id="cb51-711"><a href="#cb51-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-712"><a href="#cb51-712" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-713"><a href="#cb51-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-714"><a href="#cb51-714" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-715"><a href="#cb51-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-716"><a href="#cb51-716" aria-hidden="true" tabindex="-1"></a>The graph above shows the overall acoustic spaces, in which the sound closest to the space centroid is highlighted. The highlighted sound is selected as the template and can be used to detect similar sound events. The function <span class="in">`get_templates()`</span> can also select several templates. This can be helpful when working with sounds that are just moderately stereotyped. This is done by dividing the acoustic space into sub-spaces defined as equal-size slices of a circle centered at the centroid of the acoustic space:</span>
<span id="cb51-717"><a href="#cb51-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-718"><a href="#cb51-718" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE, echo = TRUE}</span></span>
<span id="cb51-719"><a href="#cb51-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-720"><a href="#cb51-720" aria-hidden="true" tabindex="-1"></a><span class="co"># get 3 templates</span></span>
<span id="cb51-721"><a href="#cb51-721" aria-hidden="true" tabindex="-1"></a><span class="fu">get_templates</span>(<span class="at">reference =</span> lbh_reference, </span>
<span id="cb51-722"><a href="#cb51-722" aria-hidden="true" tabindex="-1"></a>                          <span class="at">n.sub.spaces =</span> <span class="dv">3</span>, <span class="at">path =</span> <span class="fu">tempdir</span>())</span>
<span id="cb51-723"><a href="#cb51-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-724"><a href="#cb51-724" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-725"><a href="#cb51-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-726"><a href="#cb51-726" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=6, fig.height=5, eval = TRUE, echo = FALSE}</span></span>
<span id="cb51-727"><a href="#cb51-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-728"><a href="#cb51-728" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="at">bg =</span> <span class="st">"white"</span>)</span>
<span id="cb51-729"><a href="#cb51-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-730"><a href="#cb51-730" aria-hidden="true" tabindex="-1"></a><span class="co"># get 3 templates</span></span>
<span id="cb51-731"><a href="#cb51-731" aria-hidden="true" tabindex="-1"></a>templates <span class="ot">&lt;-</span> <span class="fu">get_templates</span>(<span class="at">reference =</span> lbh_reference, </span>
<span id="cb51-732"><a href="#cb51-732" aria-hidden="true" tabindex="-1"></a>                          <span class="at">n.sub.spaces =</span> <span class="dv">3</span>, <span class="at">path =</span> <span class="fu">tempdir</span>())</span>
<span id="cb51-733"><a href="#cb51-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-734"><a href="#cb51-734" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-735"><a href="#cb51-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-736"><a href="#cb51-736" aria-hidden="true" tabindex="-1"></a>We will use the single template object ('template') to run a detection on the example 'lbh1' data:</span>
<span id="cb51-737"><a href="#cb51-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-740"><a href="#cb51-740" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-741"><a href="#cb51-741" aria-hidden="true" tabindex="-1"></a><span class="co"># get correlations</span></span>
<span id="cb51-742"><a href="#cb51-742" aria-hidden="true" tabindex="-1"></a>correlations <span class="ot">&lt;-</span></span>
<span id="cb51-743"><a href="#cb51-743" aria-hidden="true" tabindex="-1"></a>  <span class="fu">template_correlator</span>(<span class="at">templates =</span> template,</span>
<span id="cb51-744"><a href="#cb51-744" aria-hidden="true" tabindex="-1"></a>                      <span class="at">files =</span> <span class="st">"lbh1.wav"</span>,</span>
<span id="cb51-745"><a href="#cb51-745" aria-hidden="true" tabindex="-1"></a>                      <span class="at">path =</span> <span class="fu">tempdir</span>())</span>
<span id="cb51-746"><a href="#cb51-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-747"><a href="#cb51-747" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-748"><a href="#cb51-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-749"><a href="#cb51-749" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-750"><a href="#cb51-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-751"><a href="#cb51-751" aria-hidden="true" tabindex="-1"></a>The output is an object of class 'template_correlations', with its own printing method:</span>
<span id="cb51-752"><a href="#cb51-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-755"><a href="#cb51-755" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-756"><a href="#cb51-756" aria-hidden="true" tabindex="-1"></a><span class="co"># print</span></span>
<span id="cb51-757"><a href="#cb51-757" aria-hidden="true" tabindex="-1"></a>correlations</span>
<span id="cb51-758"><a href="#cb51-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-759"><a href="#cb51-759" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-760"><a href="#cb51-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-761"><a href="#cb51-761" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-762"><a href="#cb51-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-763"><a href="#cb51-763" aria-hidden="true" tabindex="-1"></a>This object can then be used to detect sound events using <span class="in">`template_detector()`</span>:</span>
<span id="cb51-764"><a href="#cb51-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-767"><a href="#cb51-767" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-768"><a href="#cb51-768" aria-hidden="true" tabindex="-1"></a><span class="co"># run detection</span></span>
<span id="cb51-769"><a href="#cb51-769" aria-hidden="true" tabindex="-1"></a>detection <span class="ot">&lt;-</span></span>
<span id="cb51-770"><a href="#cb51-770" aria-hidden="true" tabindex="-1"></a>  <span class="fu">template_detector</span>(<span class="at">template.correlations =</span> correlations, <span class="at">threshold =</span> <span class="fl">0.4</span>)</span>
<span id="cb51-771"><a href="#cb51-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-772"><a href="#cb51-772" aria-hidden="true" tabindex="-1"></a>detection</span>
<span id="cb51-773"><a href="#cb51-773" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-774"><a href="#cb51-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-775"><a href="#cb51-775" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-776"><a href="#cb51-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-777"><a href="#cb51-777" aria-hidden="true" tabindex="-1"></a>The output can be explored by plotting the spectrogram along with the detection and correlation scores:</span>
<span id="cb51-778"><a href="#cb51-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-779"><a href="#cb51-779" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE}</span></span>
<span id="cb51-780"><a href="#cb51-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-781"><a href="#cb51-781" aria-hidden="true" tabindex="-1"></a><span class="co"># plot spectrogram</span></span>
<span id="cb51-782"><a href="#cb51-782" aria-hidden="true" tabindex="-1"></a><span class="fu">label_spectro</span>(</span>
<span id="cb51-783"><a href="#cb51-783" aria-hidden="true" tabindex="-1"></a>  <span class="at">wave =</span> lbh1,</span>
<span id="cb51-784"><a href="#cb51-784" aria-hidden="true" tabindex="-1"></a>  <span class="at">detection =</span> detection,</span>
<span id="cb51-785"><a href="#cb51-785" aria-hidden="true" tabindex="-1"></a>  <span class="at">template.correlation =</span> correlations[[<span class="dv">1</span>]],</span>
<span id="cb51-786"><a href="#cb51-786" aria-hidden="true" tabindex="-1"></a>  <span class="at">flim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb51-787"><a href="#cb51-787" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> <span class="fl">0.4</span>,</span>
<span id="cb51-788"><a href="#cb51-788" aria-hidden="true" tabindex="-1"></a>  <span class="at">hop.size =</span> <span class="dv">10</span>, <span class="at">ovlp =</span> <span class="dv">50</span>)</span>
<span id="cb51-789"><a href="#cb51-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-790"><a href="#cb51-790" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-791"><a href="#cb51-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-792"><a href="#cb51-792" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-793"><a href="#cb51-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-794"><a href="#cb51-794" aria-hidden="true" tabindex="-1"></a>The performance can be evaluated using <span class="in">`diagnose_detection()`</span>:</span>
<span id="cb51-795"><a href="#cb51-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-798"><a href="#cb51-798" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-799"><a href="#cb51-799" aria-hidden="true" tabindex="-1"></a><span class="co">#diagnose</span></span>
<span id="cb51-800"><a href="#cb51-800" aria-hidden="true" tabindex="-1"></a><span class="fu">diagnose_detection</span>(<span class="at">reference =</span> lbh1_reference, <span class="at">detection =</span> detection)</span>
<span id="cb51-801"><a href="#cb51-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-802"><a href="#cb51-802" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-803"><a href="#cb51-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-804"><a href="#cb51-804" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-805"><a href="#cb51-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-806"><a href="#cb51-806" aria-hidden="true" tabindex="-1"></a><span class="fu">### Optimizing template-based detection</span></span>
<span id="cb51-807"><a href="#cb51-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-808"><a href="#cb51-808" aria-hidden="true" tabindex="-1"></a>The function <span class="in">`optimize_template_detector()`</span> allows to evaluate the performance under different correlation thresholds:</span>
<span id="cb51-809"><a href="#cb51-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-812"><a href="#cb51-812" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-813"><a href="#cb51-813" aria-hidden="true" tabindex="-1"></a><span class="co"># run optimization</span></span>
<span id="cb51-814"><a href="#cb51-814" aria-hidden="true" tabindex="-1"></a>optimization <span class="ot">&lt;-</span></span>
<span id="cb51-815"><a href="#cb51-815" aria-hidden="true" tabindex="-1"></a>  <span class="fu">optimize_template_detector</span>(</span>
<span id="cb51-816"><a href="#cb51-816" aria-hidden="true" tabindex="-1"></a>    <span class="at">template.correlations =</span> correlations,</span>
<span id="cb51-817"><a href="#cb51-817" aria-hidden="true" tabindex="-1"></a>    <span class="at">reference =</span> lbh1_reference,</span>
<span id="cb51-818"><a href="#cb51-818" aria-hidden="true" tabindex="-1"></a>    <span class="at">threshold =</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.1</span>)</span>
<span id="cb51-819"><a href="#cb51-819" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb51-820"><a href="#cb51-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-821"><a href="#cb51-821" aria-hidden="true" tabindex="-1"></a><span class="co"># print output</span></span>
<span id="cb51-822"><a href="#cb51-822" aria-hidden="true" tabindex="-1"></a>optimization</span>
<span id="cb51-823"><a href="#cb51-823" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-824"><a href="#cb51-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-825"><a href="#cb51-825" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-826"><a href="#cb51-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-827"><a href="#cb51-827" aria-hidden="true" tabindex="-1"></a>Additional threshold values can be evaluated without having to run it all over again. We just need to supplied the output from the previous run with the argument <span class="in">`previous.output`</span> (the same trick can be done when optimizing an energy-based detection):</span>
<span id="cb51-828"><a href="#cb51-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-831"><a href="#cb51-831" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-832"><a href="#cb51-832" aria-hidden="true" tabindex="-1"></a><span class="co"># run optimization</span></span>
<span id="cb51-833"><a href="#cb51-833" aria-hidden="true" tabindex="-1"></a><span class="fu">optimize_template_detector</span>(</span>
<span id="cb51-834"><a href="#cb51-834" aria-hidden="true" tabindex="-1"></a>  <span class="at">template.correlations =</span> correlations,</span>
<span id="cb51-835"><a href="#cb51-835" aria-hidden="true" tabindex="-1"></a>  <span class="at">reference =</span> lbh1_reference,</span>
<span id="cb51-836"><a href="#cb51-836" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold =</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">0.7</span>),</span>
<span id="cb51-837"><a href="#cb51-837" aria-hidden="true" tabindex="-1"></a>  <span class="at">previous.output =</span> optimization</span>
<span id="cb51-838"><a href="#cb51-838" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-839"><a href="#cb51-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-840"><a href="#cb51-840" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-841"><a href="#cb51-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-842"><a href="#cb51-842" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-843"><a href="#cb51-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-844"><a href="#cb51-844" aria-hidden="true" tabindex="-1"></a>In this case several threshold values can achieved an optimal detection.</span>
<span id="cb51-845"><a href="#cb51-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-846"><a href="#cb51-846" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-847"><a href="#cb51-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-848"><a href="#cb51-848" aria-hidden="true" tabindex="-1"></a><span class="fu">### Detecting several templates</span></span>
<span id="cb51-849"><a href="#cb51-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-850"><a href="#cb51-850" aria-hidden="true" tabindex="-1"></a>Several templates can be used within the same call. Here we correlate two templates on the two example sound files, taking one template from each sound file:</span>
<span id="cb51-851"><a href="#cb51-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-854"><a href="#cb51-854" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-855"><a href="#cb51-855" aria-hidden="true" tabindex="-1"></a><span class="co"># get correlations</span></span>
<span id="cb51-856"><a href="#cb51-856" aria-hidden="true" tabindex="-1"></a>correlations <span class="ot">&lt;-</span></span>
<span id="cb51-857"><a href="#cb51-857" aria-hidden="true" tabindex="-1"></a>  <span class="fu">template_correlator</span>(</span>
<span id="cb51-858"><a href="#cb51-858" aria-hidden="true" tabindex="-1"></a>    <span class="at">templates =</span> lbh_reference[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>),],</span>
<span id="cb51-859"><a href="#cb51-859" aria-hidden="true" tabindex="-1"></a>    <span class="at">files =</span> <span class="fu">c</span>(<span class="st">"lbh1.wav"</span>, <span class="st">"lbh2.wav"</span>),</span>
<span id="cb51-860"><a href="#cb51-860" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="fu">tempdir</span>()</span>
<span id="cb51-861"><a href="#cb51-861" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb51-862"><a href="#cb51-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-863"><a href="#cb51-863" aria-hidden="true" tabindex="-1"></a><span class="co"># run detection</span></span>
<span id="cb51-864"><a href="#cb51-864" aria-hidden="true" tabindex="-1"></a>detection <span class="ot">&lt;-</span></span>
<span id="cb51-865"><a href="#cb51-865" aria-hidden="true" tabindex="-1"></a>  <span class="fu">template_detector</span>(<span class="at">template.correlations =</span> correlations, <span class="at">threshold =</span> <span class="fl">0.5</span>)</span>
<span id="cb51-866"><a href="#cb51-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-867"><a href="#cb51-867" aria-hidden="true" tabindex="-1"></a>correlations <span class="ot">&lt;-</span></span>
<span id="cb51-868"><a href="#cb51-868" aria-hidden="true" tabindex="-1"></a>  <span class="fu">template_correlator</span>(</span>
<span id="cb51-869"><a href="#cb51-869" aria-hidden="true" tabindex="-1"></a>    <span class="at">templates =</span> lbh_reference[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>),],</span>
<span id="cb51-870"><a href="#cb51-870" aria-hidden="true" tabindex="-1"></a>    <span class="at">files =</span> <span class="fu">c</span>(<span class="st">"lbh1.wav"</span>, <span class="st">"lbh2.wav"</span>),</span>
<span id="cb51-871"><a href="#cb51-871" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="fu">tempdir</span>()</span>
<span id="cb51-872"><a href="#cb51-872" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb51-873"><a href="#cb51-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-874"><a href="#cb51-874" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-875"><a href="#cb51-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-876"><a href="#cb51-876" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-877"><a href="#cb51-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-878"><a href="#cb51-878" aria-hidden="true" tabindex="-1"></a>Note that in these cases we can get the same sound event detected several times (duplicates), one by each template. We can check if that is the case just by diagnosing the detection:</span>
<span id="cb51-879"><a href="#cb51-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-882"><a href="#cb51-882" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-883"><a href="#cb51-883" aria-hidden="true" tabindex="-1"></a><span class="co">#diagnose</span></span>
<span id="cb51-884"><a href="#cb51-884" aria-hidden="true" tabindex="-1"></a><span class="fu">diagnose_detection</span>(<span class="at">reference =</span> lbh_reference, <span class="at">detection =</span> detection)</span>
<span id="cb51-885"><a href="#cb51-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-886"><a href="#cb51-886" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-887"><a href="#cb51-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-888"><a href="#cb51-888" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-889"><a href="#cb51-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-890"><a href="#cb51-890" aria-hidden="true" tabindex="-1"></a>Duplicates are shown as split positives. Fortunately, we can leave a single detected sound event by leaving only those with the highest correlation. To do this we first need to label each row in the detection using <span class="in">`label_detection()`</span> and then remove duplicates using <span class="in">`filter_detection()`</span>:</span>
<span id="cb51-891"><a href="#cb51-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-894"><a href="#cb51-894" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-895"><a href="#cb51-895" aria-hidden="true" tabindex="-1"></a><span class="co"># labeling detection</span></span>
<span id="cb51-896"><a href="#cb51-896" aria-hidden="true" tabindex="-1"></a>labeled <span class="ot">&lt;-</span></span>
<span id="cb51-897"><a href="#cb51-897" aria-hidden="true" tabindex="-1"></a>  <span class="fu">label_detection</span>(<span class="at">reference =</span> lbh_reference, <span class="at">detection =</span> detection)</span>
<span id="cb51-898"><a href="#cb51-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-899"><a href="#cb51-899" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-900"><a href="#cb51-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-901"><a href="#cb51-901" aria-hidden="true" tabindex="-1"></a>This function adds a column ('detection.class') with the class label for each row:</span>
<span id="cb51-902"><a href="#cb51-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-905"><a href="#cb51-905" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-906"><a href="#cb51-906" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(labeled<span class="sc">$</span>detection.class)</span>
<span id="cb51-907"><a href="#cb51-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-908"><a href="#cb51-908" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-909"><a href="#cb51-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-910"><a href="#cb51-910" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-911"><a href="#cb51-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-912"><a href="#cb51-912" aria-hidden="true" tabindex="-1"></a>Now we can filter out duplicates and diagnose the detection again, telling the function to select a single row per duplicate using the correlation score as a criterium (<span class="in">`by = "scores"`</span>, this column is part of the <span class="in">`template_detector()`</span> output):</span>
<span id="cb51-913"><a href="#cb51-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-916"><a href="#cb51-916" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-917"><a href="#cb51-917" aria-hidden="true" tabindex="-1"></a><span class="co"># filter</span></span>
<span id="cb51-918"><a href="#cb51-918" aria-hidden="true" tabindex="-1"></a>filtered <span class="ot">&lt;-</span> <span class="fu">filter_detection</span>(<span class="at">detection =</span> labeled, <span class="at">by =</span> <span class="st">"scores"</span>)</span>
<span id="cb51-919"><a href="#cb51-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-920"><a href="#cb51-920" aria-hidden="true" tabindex="-1"></a><span class="co"># diagnose</span></span>
<span id="cb51-921"><a href="#cb51-921" aria-hidden="true" tabindex="-1"></a><span class="fu">diagnose_detection</span>(<span class="at">reference =</span> lbh_reference, <span class="at">detection =</span> filtered)</span>
<span id="cb51-922"><a href="#cb51-922" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-923"><a href="#cb51-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-924"><a href="#cb51-924" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-925"><a href="#cb51-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-926"><a href="#cb51-926" aria-hidden="true" tabindex="-1"></a>We successfully get rid of duplicates and detected every single target sound event.</span>
<span id="cb51-927"><a href="#cb51-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-928"><a href="#cb51-928" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb51-929"><a href="#cb51-929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-930"><a href="#cb51-930" aria-hidden="true" tabindex="-1"></a><span class="fu">## Improving detection speed</span></span>
<span id="cb51-931"><a href="#cb51-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-932"><a href="#cb51-932" aria-hidden="true" tabindex="-1"></a>Detection routines can take a long time when working with large amounts of acoustic data (e.g. large sound files and/or many sound files). These are some useful points to keep in mine when trying to make a routine more time-efficient:</span>
<span id="cb51-933"><a href="#cb51-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-934"><a href="#cb51-934" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Always test procedures on small data subsets</span>
<span id="cb51-935"><a href="#cb51-935" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`template_detector()`</span> is faster than <span class="in">`energy_detector()`</span></span>
<span id="cb51-936"><a href="#cb51-936" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Parallelization (see <span class="in">`parallel`</span> argument in most functions) can significantly speed-up routines, but works better on Unix-based operating systems (linux and mac OS)</span>
<span id="cb51-937"><a href="#cb51-937" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Sampling rate matters: detecting sound events on low sampling rate files goes faster, so we should avoid having nyquist frequencies (sampling rate / 2) way higher than the highest frequency of the target sound events (sound files can be downsampled using warbleR's <span class="co">[</span><span class="ot">`fix_sound_files()`</span><span class="co">](https://marce10.github.io/warbleR/reference/selection_table.html)</span>)</span>
<span id="cb51-938"><a href="#cb51-938" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Large sound files can make the routine crash, use <span class="in">`split_acoustic_data()`</span> to split both reference tables and files into shorter clips.</span>
<span id="cb51-939"><a href="#cb51-939" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Think about using a computer with lots of RAM memory or a computer cluster for working on large amounts of data</span>
<span id="cb51-940"><a href="#cb51-940" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`thinning`</span> argument (which reduces the size of the amplitude envelope) can also speed-up <span class="in">`energy_detector()`</span></span>
<span id="cb51-941"><a href="#cb51-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-942"><a href="#cb51-942" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-943"><a href="#cb51-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-944"><a href="#cb51-944" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb51-945"><a href="#cb51-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-946"><a href="#cb51-946" aria-hidden="true" tabindex="-1"></a><span class="fu">## Additional tips</span></span>
<span id="cb51-947"><a href="#cb51-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-948"><a href="#cb51-948" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Use your knowledge about the sound event structure to determine the initial range for the tuning parameters in a detection optimization routine</span>
<span id="cb51-949"><a href="#cb51-949" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If people have a hard time figuring out where a target sound event occurs in a recording, detection algorithms will also have a hard time</span>
<span id="cb51-950"><a href="#cb51-950" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Several templates representing the range of variation in sound event structure can be used to detect semi-stereotyped sound events</span>
<span id="cb51-951"><a href="#cb51-951" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Make sure reference tables contain all target sound events and only the target sound events. The performance of the detection cannot be better than the reference itself.</span>
<span id="cb51-952"><a href="#cb51-952" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Avoid having overlapping sound events or several sound events as a single one (like a multi-syllable vocalization) in the reference table when running an energy-based detector</span>
<span id="cb51-953"><a href="#cb51-953" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Low-precision can be improved by training a classification model (e.g. random forest) to tell sound events from noise</span>
<span id="cb51-954"><a href="#cb51-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-955"><a href="#cb51-955" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb51-956"><a href="#cb51-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-957"><a href="#cb51-957" aria-hidden="true" tabindex="-1"></a>::: {.alert .alert-info}</span>
<span id="cb51-958"><a href="#cb51-958" aria-hidden="true" tabindex="-1"></a>Please cite <span class="co">[</span><span class="ot">ohun</span><span class="co">](https://github.com/maRce10/ohun)</span> like this:</span>
<span id="cb51-959"><a href="#cb51-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-960"><a href="#cb51-960" aria-hidden="true" tabindex="-1"></a>Araya-Salas, M. (2021), *ohun: diagnosing and optimizing automated sound event detection*. R package version 0.1.0.</span>
<span id="cb51-961"><a href="#cb51-961" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb51-962"><a href="#cb51-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-963"><a href="#cb51-963" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-964"><a href="#cb51-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-965"><a href="#cb51-965" aria-hidden="true" tabindex="-1"></a><span class="fu">## References</span></span>
<span id="cb51-966"><a href="#cb51-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-967"><a href="#cb51-967" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Araya-Salas, M. (2021), ohun: diagnosing and optimizing automated sound event detection. R package version 0.1.0.</span>
<span id="cb51-968"><a href="#cb51-968" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Araya-Salas M, Smith-Vidaurre G (2017) warbleR: An R package to streamline analysis of animal sound events. Methods Ecol Evol 8:184-191.</span>
<span id="cb51-969"><a href="#cb51-969" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>Khanna H., Gaunt S.L.L. &amp; McCallum D.A. (1997). Digital spectrographic cross-correlation: tests of sensitivity. Bioacoustics 7(3): 209-234.</span>
<span id="cb51-970"><a href="#cb51-970" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>Knight, E.C., Hannah, K.C., Foley, G.J., Scott, C.D., Brigham, R.M. &amp; Bayne, E. (2017). Recommendations for acoustic recognizer performance assessment with application to five common automated signal recognition programs. Avian Conservation and Ecology,</span>
<span id="cb51-971"><a href="#cb51-971" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>Macmillan, N. A., &amp; Creelman, C.D. (2004). Detection theory: A user's guide. Psychology press.</span>
<span id="cb51-972"><a href="#cb51-972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-973"><a href="#cb51-973" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb51-974"><a href="#cb51-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-975"><a href="#cb51-975" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb51-976"><a href="#cb51-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-977"><a href="#cb51-977" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;font</span> <span class="er">size</span><span class="ot">=</span><span class="st">"4"</span><span class="kw">&gt;</span>Session information<span class="kw">&lt;/font&gt;</span></span>
<span id="cb51-978"><a href="#cb51-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-979"><a href="#cb51-979" aria-hidden="true" tabindex="-1"></a><span class="in">```{r session info, echo=F}</span></span>
<span id="cb51-980"><a href="#cb51-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-981"><a href="#cb51-981" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb51-982"><a href="#cb51-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-983"><a href="#cb51-983" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">Copyright 2023 | <a href="https://marce10.github.io">Marcelo Araya-Salas</a></div>
  </div>
</footer>



</body></html>