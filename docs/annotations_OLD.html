<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>annotations_OLD.knit</title>

<script src="site_libs/header-attrs-2.10/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">BOKU bioacoustics R 2022</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="program.html">Program</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="introduction.html">Introduction</a>
    </li>
    <li>
      <a href="r_basics.html">R basics</a>
    </li>
    <li>
      <a href="sound.html">Sound</a>
    </li>
    <li>
      <a href="spectrograms.html">Spectrograms</a>
    </li>
    <li>
      <a href="seewave.html">seewave</a>
    </li>
    <li>
      <a href="annotations.html">Annotations</a>
    </li>
    <li>
      <a href="ohun.html">ohun: automatic detection</a>
    </li>
    <li>
      <a href="intro_to_warbler.html">Intro to warbleR</a>
    </li>
    <li>
      <a href="measure_acoustic_structure.html">Measure acoustic structure</a>
    </li>
    <li>
      <a href="comparing_methods.html">Comparing measuring methods</a>
    </li>
    <li>
      <a href="quality_checks.html">Quality checks</a>
    </li>
  </ul>
</li>
<li>
  <a href="course_prep.html">Course prep</a>
</li>
<li>
  <a href="instructor.html">Instructor</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore"><center>
<font size="7"><b>Import annotations into R</b></font>
</center></h1>
<h3 class="subtitle"><center>
<font size="4"><b>Analysis of animal acoustic signals in R</b> <br> BOKU International Wildlife Lectures</font>
</center></h3>
<h4 class="author"><center>
<font size="3"><a href="http://marceloarayasalas.weebly.com/">Marcelo Araya-Salas, PhD</a></font>
</center></h4>
<h4 class="date"><center>
“2022-03-16”
</center></h4>

</div>


<p> </p>
<div id="annotation-tables" class="section level2">
<h2>Annotation tables</h2>
<p>An annotation table (or selection table in Raven’s terminology and <strong>warbleR</strong>) is a spreadsheet that contains information about the location (and frequency) of the sounds of interest in one or more sound files. Therefore, the basic annotation table should contain at least 3 columns:</p>
<table class="table table-striped" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
sound.files
</th>
<th style="text-align:center;">
start
</th>
<th style="text-align:center;">
end
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
sound_file_1.wav
</td>
<td style="text-align:center;">
1.85
</td>
<td style="text-align:center;">
2.77
</td>
</tr>
<tr>
<td style="text-align:center;">
sound_file_1.wav
</td>
<td style="text-align:center;">
2.60
</td>
<td style="text-align:center;">
4.24
</td>
</tr>
<tr>
<td style="text-align:center;">
sound_file_2.wav
</td>
<td style="text-align:center;">
4.47
</td>
<td style="text-align:center;">
6.45
</td>
</tr>
<tr>
<td style="text-align:center;">
sound_file_2.wav
</td>
<td style="text-align:center;">
1.09
</td>
<td style="text-align:center;">
2.92
</td>
</tr>
</tbody>
</table>
<p> </p>
<p>Ideally we should also include the frequency range of the annotations:</p>
<table class="table table-striped" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
sound.files
</th>
<th style="text-align:center;">
start
</th>
<th style="text-align:center;">
end
</th>
<th style="text-align:center;">
bottom.freq
</th>
<th style="text-align:center;">
top.freq
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
sound_file_1.wav
</td>
<td style="text-align:center;">
1.85
</td>
<td style="text-align:center;">
2.77
</td>
<td style="text-align:center;background-color: #ccebff !important;">
4.86
</td>
<td style="text-align:center;background-color: #ccebff !important;">
8.76
</td>
</tr>
<tr>
<td style="text-align:center;">
sound_file_1.wav
</td>
<td style="text-align:center;">
2.60
</td>
<td style="text-align:center;">
4.24
</td>
<td style="text-align:center;background-color: #ccebff !important;">
4.32
</td>
<td style="text-align:center;background-color: #ccebff !important;">
9.12
</td>
</tr>
<tr>
<td style="text-align:center;">
sound_file_2.wav
</td>
<td style="text-align:center;">
4.47
</td>
<td style="text-align:center;">
6.45
</td>
<td style="text-align:center;background-color: #ccebff !important;">
4.46
</td>
<td style="text-align:center;background-color: #ccebff !important;">
9.28
</td>
</tr>
<tr>
<td style="text-align:center;">
sound_file_2.wav
</td>
<td style="text-align:center;">
1.09
</td>
<td style="text-align:center;">
2.92
</td>
<td style="text-align:center;background-color: #ccebff !important;">
5.47
</td>
<td style="text-align:center;background-color: #ccebff !important;">
7.43
</td>
</tr>
</tbody>
</table>
<p> </p>
<p>.. and a unique identifier (at least within each sound file) for each annotation:</p>
<table class="table table-striped" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
sound.files
</th>
<th style="text-align:center;">
selec
</th>
<th style="text-align:center;">
start
</th>
<th style="text-align:center;">
end
</th>
<th style="text-align:center;">
bottom.freq
</th>
<th style="text-align:center;">
top.freq
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
sound_file_1.wav
</td>
<td style="text-align:center;background-color: #ccebff !important;">
1
</td>
<td style="text-align:center;">
1.85
</td>
<td style="text-align:center;">
2.77
</td>
<td style="text-align:center;">
4.86
</td>
<td style="text-align:center;">
8.76
</td>
</tr>
<tr>
<td style="text-align:center;">
sound_file_1.wav
</td>
<td style="text-align:center;background-color: #ccebff !important;">
2
</td>
<td style="text-align:center;">
2.60
</td>
<td style="text-align:center;">
4.24
</td>
<td style="text-align:center;">
4.32
</td>
<td style="text-align:center;">
9.12
</td>
</tr>
<tr>
<td style="text-align:center;">
sound_file_2.wav
</td>
<td style="text-align:center;background-color: #ccebff !important;">
1
</td>
<td style="text-align:center;">
4.47
</td>
<td style="text-align:center;">
6.45
</td>
<td style="text-align:center;">
4.46
</td>
<td style="text-align:center;">
9.28
</td>
</tr>
<tr>
<td style="text-align:center;">
sound_file_2.wav
</td>
<td style="text-align:center;background-color: #ccebff !important;">
2
</td>
<td style="text-align:center;">
1.09
</td>
<td style="text-align:center;">
2.92
</td>
<td style="text-align:center;">
5.47
</td>
<td style="text-align:center;">
7.43
</td>
</tr>
</tbody>
</table>
<p>Finally, for sound files with multiple channels, the annotation table should indicate in which channel the sound of interest is located:</p>
<table class="table table-striped" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
sound.files
</th>
<th style="text-align:center;">
channel
</th>
<th style="text-align:center;">
selec
</th>
<th style="text-align:center;">
start
</th>
<th style="text-align:center;">
end
</th>
<th style="text-align:center;">
bottom.freq
</th>
<th style="text-align:center;">
top.freq
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
sound_file_1.wav
</td>
<td style="text-align:center;background-color: #ccebff !important;">
1
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1.85
</td>
<td style="text-align:center;">
2.77
</td>
<td style="text-align:center;">
4.86
</td>
<td style="text-align:center;">
8.76
</td>
</tr>
<tr>
<td style="text-align:center;">
sound_file_1.wav
</td>
<td style="text-align:center;background-color: #ccebff !important;">
1
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
2.60
</td>
<td style="text-align:center;">
4.24
</td>
<td style="text-align:center;">
4.32
</td>
<td style="text-align:center;">
9.12
</td>
</tr>
<tr>
<td style="text-align:center;">
sound_file_2.wav
</td>
<td style="text-align:center;background-color: #ccebff !important;">
1
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
4.47
</td>
<td style="text-align:center;">
6.45
</td>
<td style="text-align:center;">
4.46
</td>
<td style="text-align:center;">
9.28
</td>
</tr>
<tr>
<td style="text-align:center;">
sound_file_2.wav
</td>
<td style="text-align:center;background-color: #ccebff !important;">
1
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
1.09
</td>
<td style="text-align:center;">
2.92
</td>
<td style="text-align:center;">
5.47
</td>
<td style="text-align:center;">
7.43
</td>
</tr>
</tbody>
</table>
<p> </p>
<p>This format, with the same column names as in the previous example, is the one used by the <strong>warbleR</strong> package as a basic data object to work on batches of sounds (“batches”). The mandatory columns are “sound.files”, “selec”, “start”, and “end”. The frequency range columns (“bottom.freq” and “top.freq”) and the channel number (“channel”) are optional.</p>
<p>Annotation tables can be generated within R, or imported from sound analysis programs (mainly, Raven, Avisoft, Syrinx and Audacity).</p>
</div>
<div id="viewspec-monitor" class="section level2">
<h2>viewSpec (<strong>monitoR</strong>)</h2>
<p>The <code>viewSpec()</code> function of <strong>monitoR</strong> allows you to annotate ‘wave’ objects or sound files interactively. For this, the argument <code>annotate = TRUE</code> must be defined. When running it shows the commands that control the function:</p>
<pre class="r"><code>library(monitoR)

data(tico, package = &quot;seewave&quot;)

viewSpec(tico, annotate = TRUE, ovlp = 90)</code></pre>
<p><img src="images/viewSpec.png" alt="viewSpec"></p>
<p> </p>
<p>The commands allow you to zoom, specify the time and frequency range of the sounds and add notes:</p>
<p><img src = "viewSpec.gif" alt = "viewSpec" width = "480"></p>
<p> </p>
<p>The annotations are saved in ‘.csv’ format upon exiting the function (name must be provided).</p>
<p> </p>
</div>
<div id="audacity" class="section level2">
<h2>Audacity</h2>
<p><strong>Audacity</strong> is a free access program that allows you to manipulate sound files. It can be downloaded at <a href="https://www.audacityteam.org/download/">this link</a>.</p>
<p> </p>
<p><img src = "images/audacity_selec.gif" alt = "audacity" width = "820"> <!-- ![](images/audacity_selec.gif) --></p>
<p> </p>
<p><strong>Audacity</strong> is quite rigid to create annotation tables, although it can be useful when working with long recordings. Text files generated by <strong>Audacity</strong> can be imported to R using the <code>read.table()</code> function.</p>
<p> </p>
<div class="alert alert-info">
<p><font size="5">Exercise</font></p>
<p> </p>
<ul>
<li>Annotate 1 sound file from the “./examples” folder using <strong>Audacity</strong></li>
</ul>
<p> </p>
<ul>
<li>Import the annotation file into R using seewave’s <code>read.audacity()</code></li>
</ul>
</div>
<p> </p>
</div>
<div id="raven" class="section level2">
<h2>Raven</h2>
<p><a href="http://www.birds.cornell.edu/brp/raven/RavenOverview.html">Raven sound analysis software</a> (<a href="http://www.birds.cornell.edu">Cornell Lab of Ornithology</a>) provides very powerful tools for the analysis of sounds (animals). <strong>Raven</strong> allows you to use the cursor to manually define the frequency and time limits of the signals. It is a very flexible and user friendly program. The annotations can be saved in a selection file (selection table) in .txt format:</p>
<p> </p>
<p><img src="images/Raven.selec.gif" alt="Raven" width = "820"></p>
<p> </p>
<p>Selections can be reopened on the original file where they were made:</p>
<p> </p>
<p><img src="images/Raven.open.st.gif" alt="Raven" width = "820"></p>
<p> </p>
<p>The selections with sound (sound selection table) are a special type of annotation that contains all the information about the address of the files and allows to be opened directly without opening the sound file first. To create these selections, you must include the ‘Begin File’, ‘Begin Path’ and “File offset (s) ’columns (the latter only if the file contains annotations for more than one sound file):</p>
<p> </p>
<p><img src = "Raven.create.sst.gif" alt = "Raven" width = "820"></p>
<p> </p>
<p>These selections open easily in Raven, as long as the sound files are kept in the original folders:</p>
<p> </p>
<p><img src="images/Raven.open.sst.gif" alt="Raven" width = "820"></p>
<p> </p>
</div>
<div id="rraven" class="section level2">
<h2>Rraven</h2>
<p> </p>
<p>The <strong>Rraven</strong> package is designed to facilitate data exchange between R and <a href="http://www.birds.cornell.edu/brp/raven/RavenOverview.html">Raven sound analysis software</a>. R can simplify the automation of complex analysis routines. In addition, R packages such as <strong>warbleR</strong>, <strong>seewave</strong> and <strong>monitorR</strong> (among others) provide additional methods of analysis, which work as a perfect complement to those found in Raven. Therefore, bridging these applications can greatly expand the bioacoustic toolkit.</p>
<p>Currently, most Raven analyzes cannot be run in the background from a command terminal. Therefore, most of the <strong>Rraven</strong> functions are designed to simplify the exchange of data between the two programs, and in some cases, export files to Raven for further analysis. This tutorial provides detailed examples for each function in <strong>Rraven</strong>, including both the R code and the additional steps required to fully conduct the analyses. Raven Pro must be installed in order to run some of the code.</p>
<p>In this link you will find several videos that show in detail the different tools in Raven.</p>
<p><a href="http://ravensoundsoftware.com/video-tutorials/" class="uri">http://ravensoundsoftware.com/video-tutorials/</a></p>
<p> </p>
</div>
<div id="import-raven-data" class="section level2">
<h2>Import Raven data</h2>
<div id="imp_raven" class="section level3">
<h3><em>imp_raven</em></h3>
<p>This function imports Raven selection tables. You can import several files at once. Raven can also import selection tables that include data from multiple recordings. The function returns a single data frame with the information contained in the selection files. We already have 4 Raven selection tables in the example directory:</p>
<pre class="r"><code>list.files(path = &quot;./examples&quot;, pattern = &quot;\\.txt$&quot;)</code></pre>
<pre><code>## [1] &quot;Label Track3.txt&quot;                  &quot;LBH 1 selection table example.txt&quot;
## [3] &quot;LBH 2 selection table example.txt&quot; &quot;LBH 3 selection table example.txt&quot;
## [5] &quot;LBH 4 selection table example.txt&quot;</code></pre>
<p> </p>
<p>This code shows how to import all the data contained in those files into R:</p>
<pre class="r"><code>rvn.dat &lt;- imp_raven(all.data = TRUE, path = &quot;./examples&quot;)

head(rvn.dat)</code></pre>
<pre><code>## 1 file(s) could not be read:  Label Track3.txt</code></pre>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:808px; ">
<table class="table table-striped table-hover table-condensed table-responsive" style="font-size: 11px; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
Selection
</th>
<th style="text-align:center;">
View
</th>
<th style="text-align:center;">
Channel
</th>
<th style="text-align:center;">
Begin Time (s)
</th>
<th style="text-align:center;">
End Time (s)
</th>
<th style="text-align:center;">
Low Freq (Hz)
</th>
<th style="text-align:center;">
High Freq (Hz)
</th>
<th style="text-align:center;">
Begin File
</th>
<th style="text-align:center;">
channel
</th>
<th style="text-align:center;">
Begin Path
</th>
<th style="text-align:center;">
File Offset (s)
</th>
<th style="text-align:center;">
File Offset
</th>
<th style="text-align:center;">
selec.file
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
Spectrogram 1
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1.169
</td>
<td style="text-align:center;">
1.342
</td>
<td style="text-align:center;">
2220
</td>
<td style="text-align:center;">
8604
</td>
<td style="text-align:center;">
Phae.long1.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
/tmp/RtmpWpOeaR/Phae.long1.wav
</td>
<td style="text-align:center;">
1.169
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
LBH 1 selection table example.txt
</td>
</tr>
<tr>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
Spectrogram 1
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
2.158
</td>
<td style="text-align:center;">
2.321
</td>
<td style="text-align:center;">
2169
</td>
<td style="text-align:center;">
8807
</td>
<td style="text-align:center;">
Phae.long1.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
/tmp/RtmpWpOeaR/Phae.long1.wav
</td>
<td style="text-align:center;">
2.158
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
LBH 1 selection table example.txt
</td>
</tr>
<tr>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
Spectrogram 1
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.343
</td>
<td style="text-align:center;">
0.518
</td>
<td style="text-align:center;">
2218
</td>
<td style="text-align:center;">
8757
</td>
<td style="text-align:center;">
Phae.long1.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
/tmp/RtmpWpOeaR/Phae.long1.wav
</td>
<td style="text-align:center;">
0.343
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
LBH 1 selection table example.txt
</td>
</tr>
<tr>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
Spectrogram 1
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.160
</td>
<td style="text-align:center;">
0.292
</td>
<td style="text-align:center;">
2317
</td>
<td style="text-align:center;">
8822
</td>
<td style="text-align:center;">
Phae.long2.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
/tmp/RtmpWpOeaR/Phae.long2.wav
</td>
<td style="text-align:center;">
0.160
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
LBH 2 selection table example.txt
</td>
</tr>
<tr>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
Spectrogram 1
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1.457
</td>
<td style="text-align:center;">
1.583
</td>
<td style="text-align:center;">
2284
</td>
<td style="text-align:center;">
8888
</td>
<td style="text-align:center;">
Phae.long2.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
/tmp/RtmpWpOeaR/Phae.long2.wav
</td>
<td style="text-align:center;">
1.457
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
LBH 2 selection table example.txt
</td>
</tr>
<tr>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
Spectrogram 1
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.627
</td>
<td style="text-align:center;">
0.758
</td>
<td style="text-align:center;">
3007
</td>
<td style="text-align:center;">
8822
</td>
<td style="text-align:center;">
Phae.long3.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
/tmp/RtmpWpOeaR/Phae.long3.wav
</td>
<td style="text-align:center;">
NA
</td>
<td style="text-align:center;">
0.627
</td>
<td style="text-align:center;">
LBH 3 selection table example.txt
</td>
</tr>
</tbody>
</table>
</div>
<p> </p>
<p>Note that the ‘waveform’ view data has been deleted. It can also be imported as follows (but note that the example selection tables do not have waveform data):</p>
<pre class="r"><code>rvn.dat &lt;- imp_raven(all.data = TRUE, waveform = TRUE, path = &quot;./examples&quot;)</code></pre>
<p> </p>
<p>Raven selections can also be imported in ‘selection.table’ format so that you can input directly into <strong>warbleR</strong> functions. To do this, you only need to set <code>warbler.format = TRUE</code>:</p>
<pre class="r"><code>rvn.dat &lt;- imp_raven(all.data = FALSE, freq.cols = TRUE, path = &quot;./examples&quot;, warbler.format = TRUE, all.data = FALSE)

head(rvn.dat)</code></pre>
<pre><code>## 1 file(s) could not be read:  Label Track3.txt</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="font-size: 12px; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
selec
</th>
<th style="text-align:center;">
Channel
</th>
<th style="text-align:center;">
start
</th>
<th style="text-align:center;">
end
</th>
<th style="text-align:center;">
bottom.freq
</th>
<th style="text-align:center;">
top.freq
</th>
<th style="text-align:center;">
sound.files
</th>
<th style="text-align:center;">
channel
</th>
<th style="text-align:center;">
selec.file
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1.169355
</td>
<td style="text-align:center;">
1.342388
</td>
<td style="text-align:center;">
2.22011
</td>
<td style="text-align:center;">
8.60438
</td>
<td style="text-align:center;">
Phae.long1.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
LBH 1 selection table example.txt
</td>
</tr>
<tr>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
2.158408
</td>
<td style="text-align:center;">
2.321457
</td>
<td style="text-align:center;">
2.16944
</td>
<td style="text-align:center;">
8.80705
</td>
<td style="text-align:center;">
Phae.long1.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
LBH 1 selection table example.txt
</td>
</tr>
<tr>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.343337
</td>
<td style="text-align:center;">
0.518255
</td>
<td style="text-align:center;">
2.21829
</td>
<td style="text-align:center;">
8.75660
</td>
<td style="text-align:center;">
Phae.long1.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
LBH 1 selection table example.txt
</td>
</tr>
<tr>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.159598
</td>
<td style="text-align:center;">
0.292169
</td>
<td style="text-align:center;">
2.31686
</td>
<td style="text-align:center;">
8.82232
</td>
<td style="text-align:center;">
Phae.long2.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
LBH 2 selection table example.txt
</td>
</tr>
<tr>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1.457058
</td>
<td style="text-align:center;">
1.583209
</td>
<td style="text-align:center;">
2.28401
</td>
<td style="text-align:center;">
8.88803
</td>
<td style="text-align:center;">
Phae.long2.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
LBH 2 selection table example.txt
</td>
</tr>
<tr>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.626552
</td>
<td style="text-align:center;">
0.757771
</td>
<td style="text-align:center;">
3.00683
</td>
<td style="text-align:center;">
8.82232
</td>
<td style="text-align:center;">
Phae.long3.wav
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
LBH 3 selection table example.txt
</td>
</tr>
</tbody>
</table>
<p> </p>
<p>The output data frame contains the following columns: “sound.files”, “channel”, “selec”, “start”, “end” and “selec.file.” You can also import the frequency range parameters in ‘selection.table’ by setting ‘freq.cols’ tp <code>TRUE</code>. The data frame returned by <code>imp_raven()</code> (when in the <strong>warbleR</strong> format) can be entered into several functions of <strong>warbleR</strong> for a more detailed analysis.</p>
</div>
<div id="relabel_colms" class="section level3">
<h3><em>relabel_colms</em></h3>
<p>This is a simple function to re-label the columns to match the format of the selection table used in <strong>warbleR</strong>:</p>
<pre class="r"><code># para simplificar solo las primeras 7 columnas
st1 &lt;- rvn.dat[ ,1:7]

st1</code></pre>
<pre class="r"><code>relabel_colms(st1)</code></pre>
<p> </p>
<p>Additional columns can also be re-labeled:</p>
<pre class="r"><code>relabel_colms(st1, extra.cols.name = &quot;View&quot;,
              extra.cols.new.name = &quot;Raven view&quot;)</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="font-size: 14px; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
selec
</th>
<th style="text-align:center;">
Channel
</th>
<th style="text-align:center;">
start
</th>
<th style="text-align:center;">
end
</th>
<th style="text-align:center;">
bottom.freq
</th>
<th style="text-align:center;">
top.freq
</th>
<th style="text-align:center;">
sound.files
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1.169355
</td>
<td style="text-align:center;">
1.342388
</td>
<td style="text-align:center;">
2.22011
</td>
<td style="text-align:center;">
8.60438
</td>
<td style="text-align:center;">
Phae.long1.wav
</td>
</tr>
<tr>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
2.158408
</td>
<td style="text-align:center;">
2.321457
</td>
<td style="text-align:center;">
2.16944
</td>
<td style="text-align:center;">
8.80705
</td>
<td style="text-align:center;">
Phae.long1.wav
</td>
</tr>
<tr>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.343337
</td>
<td style="text-align:center;">
0.518255
</td>
<td style="text-align:center;">
2.21829
</td>
<td style="text-align:center;">
8.75660
</td>
<td style="text-align:center;">
Phae.long1.wav
</td>
</tr>
<tr>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.159598
</td>
<td style="text-align:center;">
0.292169
</td>
<td style="text-align:center;">
2.31686
</td>
<td style="text-align:center;">
8.82232
</td>
<td style="text-align:center;">
Phae.long2.wav
</td>
</tr>
<tr>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1.457058
</td>
<td style="text-align:center;">
1.583209
</td>
<td style="text-align:center;">
2.28401
</td>
<td style="text-align:center;">
8.88803
</td>
<td style="text-align:center;">
Phae.long2.wav
</td>
</tr>
<tr>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.626552
</td>
<td style="text-align:center;">
0.757771
</td>
<td style="text-align:center;">
3.00683
</td>
<td style="text-align:center;">
8.82232
</td>
<td style="text-align:center;">
Phae.long3.wav
</td>
</tr>
<tr>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1.974213
</td>
<td style="text-align:center;">
2.104392
</td>
<td style="text-align:center;">
2.77684
</td>
<td style="text-align:center;">
8.88803
</td>
<td style="text-align:center;">
Phae.long3.wav
</td>
</tr>
<tr>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.123364
</td>
<td style="text-align:center;">
0.254581
</td>
<td style="text-align:center;">
2.31686
</td>
<td style="text-align:center;">
9.31515
</td>
<td style="text-align:center;">
Phae.long3.wav
</td>
</tr>
<tr>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1.516812
</td>
<td style="text-align:center;">
1.662236
</td>
<td style="text-align:center;">
2.51400
</td>
<td style="text-align:center;">
9.21659
</td>
<td style="text-align:center;">
Phae.long4.wav
</td>
</tr>
<tr>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
2.932692
</td>
<td style="text-align:center;">
3.076878
</td>
<td style="text-align:center;">
2.57971
</td>
<td style="text-align:center;">
10.23512
</td>
<td style="text-align:center;">
Phae.long4.wav
</td>
</tr>
<tr>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0.145398
</td>
<td style="text-align:center;">
0.290497
</td>
<td style="text-align:center;">
2.57971
</td>
<td style="text-align:center;">
9.74228
</td>
<td style="text-align:center;">
Phae.long4.wav
</td>
</tr>
</tbody>
</table>
<p> </p>
</div>
</div>
<div id="export-r-data-to-raven" class="section level2">
<h2>Export R data to Raven</h2>
<div id="exp_raven" class="section level3">
<h3><em>exp_raven</em></h3>
<p><em>exp_raven</em> saves a selection table in ‘.txt’ format that can be opened directly in Raven. No objects are returned to the R environment. The following code exports a selection table from a single sound file:</p>
<pre class="r"><code>st1 &lt;- lbh_selec_table[lbh_selec_table$sound.files == &quot;Phae.long1.wav&quot;,]

exp_raven(st1, file.name = &quot;Phaethornis 1&quot;, khz.to.hz = TRUE)</code></pre>
<p> </p>
<p>If the path to the sound file is provided, the functions export a ‘sound selection table’ that can be opened directly by Raven (and which will also open the associated sound file):</p>
<pre class="r"><code>st1 &lt;- lbh_selec_table[lbh_selec_table$sound.files == &quot;Phae.long1.wav&quot;,]

exp_raven(st1, file.name = &quot;Phaethornis 1&quot;, khz.to.hz = TRUE, sound.file.path = &quot;./examples&quot;)</code></pre>
<p><img src="images/exp_raven1.gif" /> <img src = "images/exp_raven1.gif" alt = "expraven1" width = "480"></p>
<p> </p>
<p>This is useful for adding new selections or even new measurements:</p>
<p><img src="images/exp_raven2.gif" />  </p>
<p>If there are several sound files available, users can export them as a single selection file or as multiple selection files (one for each sound file). This example creates a multiple selection of sound files:</p>
<pre class="r"><code>exp_raven(X = lbh_selec_table, file.name = &quot;Phaethornis multiple sound files&quot;, 
sound.file.path = &quot;./examples&quot;, single.file = TRUE)</code></pre>
<p> </p>
<p>These types of tables can be opened as a multi-file display in Raven:</p>
<div class="figure">
<img src="images/exp_raven3.gif" alt="" />
<p class="caption">ex</p>
</div>
<p> </p>
<hr />
</div>
</div>
<div id="running-raven-from-r" class="section level2">
<h2>Running Raven from R</h2>
<div id="run_raven" class="section level3">
<h3><em>run_raven</em></h3>
<p>The function opens multiple sound files simultaneously in Raven. When the analysis is completed (and the Raven window is closed) the data can be automatically re-imported to R using the ‘import’ argument. Note that Raven, unlike R, can also handle files in the format ‘mp3’, ‘flac’ and ‘aif’:</p>
<pre class="r"><code># remplace con la direccion en su computadora
raven.path &lt;- &quot;DIRECCION_A_LA_CARPETA_DE_RAVEN AQUI&quot; 

run_raven(raven.path = raven.path, sound.files = c(&quot;Phae.long1.wav&quot;, &quot;Phae.long2.wav&quot;, &quot;Phae.long3.wav&quot;, &quot;Phae.long4.wav&quot;), import = TRUE, 
 all.data = TRUE)  </code></pre>
<div class="figure">
<img src="images/run_raven1.gif" alt="" />
<p class="caption">gif5</p>
</div>
<p> </p>
<div class="alert alert-info">
<p><font size="5">Exercise</font></p>
<p> </p>
<ul>
<li>Annotate 2 sound files from the “./examples” folder using <strong>Raven</strong></li>
</ul>
<p> </p>
<ul>
<li>Import the annotation files into R using Rraven’s <code>imp_raven()</code></li>
</ul>
<p> </p>
<ul>
<li>Annotate the sound files again but this time adding some acoustic measurements to the annotation</li>
</ul>
<p> </p>
<ul>
<li>Import the new annotation into R, including all <strong>Raven</strong> measurements</li>
</ul>
</div>
<p> </p>
<hr />
</div>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<ul>
<li>Araya-Salas (2017), <em>Rraven: connecting R and Raven bioacoustic software</em>. R package version 1.0.2.</li>
</ul>
<hr />
<p> </p>
<p><font size="4">Session information</font></p>
<pre><code>## R version 4.1.1 (2021-08-10)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 20.04.2 LTS
## 
## Matrix products: default
## BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.9.0
## LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.9.0
## 
## locale:
##  [1] LC_CTYPE=es_ES.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=es_CR.UTF-8        LC_COLLATE=es_ES.UTF-8    
##  [5] LC_MONETARY=es_CR.UTF-8    LC_MESSAGES=es_ES.UTF-8   
##  [7] LC_PAPER=es_CR.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=es_CR.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] Rraven_1.0.13    kableExtra_1.3.4
## 
## loaded via a namespace (and not attached):
##  [1] rstudioapi_0.13   knitr_1.37        xml2_1.3.2        magrittr_2.0.2   
##  [5] rvest_1.0.1       munsell_0.5.0     viridisLite_0.4.0 colorspace_2.0-3 
##  [9] R6_2.5.1          rlang_1.0.2       fastmap_1.1.0     pbapply_1.5-0    
## [13] highr_0.9         stringr_1.4.0     httr_1.4.2        tools_4.1.1      
## [17] parallel_4.1.1    webshot_0.5.2     xfun_0.30         cli_3.2.0        
## [21] jquerylib_0.1.4   systemfonts_1.0.2 htmltools_0.5.2   yaml_2.3.5       
## [25] digest_0.6.29     lifecycle_1.0.1   sass_0.4.0        glue_1.6.2       
## [29] evaluate_0.15     rmarkdown_2.10    stringi_1.7.6     compiler_4.1.1   
## [33] bslib_0.2.5.1     scales_1.1.1      svglite_2.0.0     jsonlite_1.7.2</code></pre>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = false;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
